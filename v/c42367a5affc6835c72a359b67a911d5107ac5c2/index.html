<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Chaya D Stern" />
  <meta name="author" content="Christopher I Bayly" />
  <meta name="author" content="Daniel G A Smith" />
  <meta name="author" content="Josh Fass" />
  <meta name="author" content="Lee-Ping Wang" />
  <meta name="author" content="David L Mobley" />
  <meta name="author" content="John D Chodera" />
  <meta name="dcterms.date" content="2020-08-23" />
  <meta name="keywords" content="forcefield, force-field, cheminformatics" />
  <title>Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!--
  Manubot generated metadata rendered from header-includes-template.html.
  Suggest improvements at https://github.com/manubot/manubot/blob/master/manubot/process/header-includes-template.html
  -->
  <meta name="dc.format" content="text/html" />
  <meta name="dc.title" content="Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans" />
  <meta name="citation_title" content="Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans" />
  <meta property="og:title" content="Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans" />
  <meta property="twitter:title" content="Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans" />
  <meta name="dc.date" content="2020-08-23" />
  <meta name="citation_publication_date" content="2020-08-23" />
  <meta name="dc.language" content="en-US" />
  <meta name="citation_language" content="en-US" />
  <meta name="dc.relation.ispartof" content="Manubot" />
  <meta name="dc.publisher" content="Manubot" />
  <meta name="citation_journal_title" content="Manubot" />
  <meta name="citation_technical_report_institution" content="Manubot" />
  <meta name="citation_author" content="Chaya D Stern" />
  <meta name="citation_author_institution" content="Tri-Insitutional PhD Program in Chemical Biology, Memorial Sloan Kettering Cancer Center, New York, New York 10065, USA" />
  <meta name="citation_author_institution" content="Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, New York 10065 USA" />
  <meta name="citation_author_orcid" content="0000-0001-6200-3993" />
  <meta name="twitter:creator" content="@SternChaya" />
  <meta name="citation_author" content="Christopher I Bayly" />
  <meta name="citation_author_institution" content="OpenEye Scientific Software" />
  <meta name="citation_author_orcid" content="0000-0001-9145-6457" />
  <meta name="citation_author" content="Daniel G A Smith" />
  <meta name="citation_author_institution" content="The Molecular Sciences Software Institute, Blacksburg, Virginia 24060 USA" />
  <meta name="citation_author_orcid" content="0000-0001-8626-0900" />
  <meta name="twitter:creator" content="@dga_smith" />
  <meta name="citation_author" content="Josh Fass" />
  <meta name="citation_author_institution" content="Tri-Insitutional PhD Program in Chemical Biology, Memorial Sloan Kettering Cancer Center, New York, New York 10065, USA" />
  <meta name="citation_author_institution" content="Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, New York 10065 USA" />
  <meta name="citation_author_orcid" content="0000-0003-3719-266X" />
  <meta name="twitter:creator" content="@maxentile" />
  <meta name="citation_author" content="Lee-Ping Wang" />
  <meta name="citation_author_institution" content="Department of Chemistry, University of California, Davis, Califnornia 95616 USA" />
  <meta name="citation_author_orcid" content="0000-0003-3072-9946" />
  <meta name="citation_author" content="David L Mobley" />
  <meta name="citation_author_institution" content="Departments of Pharmaceutical Sciences and Chemistry, University of California, Irvine, California 92697" />
  <meta name="citation_author_orcid" content="0000-0002-1083-5533" />
  <meta name="twitter:creator" content="@davidmobley" />
  <meta name="citation_author" content="John D Chodera" />
  <meta name="citation_author_institution" content="Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, New York 10065 USA" />
  <meta name="citation_author_institution" content="BIH Einstein Visiting Professor, Charité Universitätsmedizin, Berlin" />
  <meta name="citation_author_orcid" content="0000-0003-0542-119X" />
  <meta name="twitter:creator" content="@jchodera" />
  <link rel="canonical" href="https://ChayaSt.github.io/frag-manuscript/" />
  <meta property="og:url" content="https://ChayaSt.github.io/frag-manuscript/" />
  <meta property="twitter:url" content="https://ChayaSt.github.io/frag-manuscript/" />
  <meta name="citation_fulltext_html_url" content="https://ChayaSt.github.io/frag-manuscript/" />
  <meta name="citation_pdf_url" content="https://ChayaSt.github.io/frag-manuscript/manuscript.pdf" />
  <link rel="alternate" type="application/pdf" href="https://ChayaSt.github.io/frag-manuscript/manuscript.pdf" />
  <link rel="alternate" type="text/html" href="https://ChayaSt.github.io/frag-manuscript/v/c42367a5affc6835c72a359b67a911d5107ac5c2/" />
  <meta name="manubot_html_url_versioned" content="https://ChayaSt.github.io/frag-manuscript/v/c42367a5affc6835c72a359b67a911d5107ac5c2/" />
  <meta name="manubot_pdf_url_versioned" content="https://ChayaSt.github.io/frag-manuscript/v/c42367a5affc6835c72a359b67a911d5107ac5c2/manuscript.pdf" />
  <meta property="og:type" content="article" />
  <meta property="twitter:card" content="summary_large_image" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://manubot.org/favicon-192x192.png" />
  <link rel="mask-icon" href="https://manubot.org/safari-pinned-tab.svg" color="#ad1457" />
  <meta name="theme-color" content="#ad1457" />
  <!-- end Manubot generated metadata -->
  
  <!-- pandoc-eqnos: equation style -->
  <style>
    .eqnos { display: inline-block; position: relative; width: 100%; }
    .eqnos br { display: none; }
    .eqnos-number { position: absolute; right: 0em; top: 50%; line-height: 0; }
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans</h1>
</header>
<p><small><em>
This manuscript
(<a href="https://ChayaSt.github.io/frag-manuscript/v/c42367a5affc6835c72a359b67a911d5107ac5c2/">permalink</a>)
was automatically generated
from <a href="https://github.com/ChayaSt/frag-manuscript/tree/c42367a5affc6835c72a359b67a911d5107ac5c2">ChayaSt/frag-manuscript@c42367a</a>
on August 23, 2020.
</em></small></p>
<h2 id="authors">Authors</h2>
<ul>
<li><p><strong>Chaya D Stern</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0001-6200-3993">0000-0001-6200-3993</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/ChayaSt">ChayaSt</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/SternChaya">SternChaya</a><br>
<small>
Tri-Insitutional PhD Program in Chemical Biology, Memorial Sloan Kettering Cancer Center, New York, New York 10065, USA; Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, New York 10065 USA
· Funded by NSF GRFP DGE-1257284; MolSSI NSF ACI-1547580; NSF CHE-1738979
</small></p></li>
<li><p><strong>Christopher I Bayly</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0001-9145-6457">0000-0001-9145-6457</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/cbayly13">cbayly13</a><br>
<small>
OpenEye Scientific Software
</small></p></li>
<li><p><strong>Daniel G A Smith</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0001-8626-0900">0000-0001-8626-0900</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/dgasmith">dgasmith</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/dga_smith">dga_smith</a><br>
<small>
The Molecular Sciences Software Institute, Blacksburg, Virginia 24060 USA
· Funded by NSF OAC-1547580; Open Force Field Consortium
</small></p></li>
<li><p><strong>Josh Fass</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-3719-266X">0000-0003-3719-266X</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/maxentile">maxentile</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/maxentile">maxentile</a><br>
<small>
Tri-Insitutional PhD Program in Chemical Biology, Memorial Sloan Kettering Cancer Center, New York, New York 10065, USA; Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, New York 10065 USA
· Funded by NSF CHE-1738979
</small></p></li>
<li><p><strong>Lee-Ping Wang</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-3072-9946">0000-0003-3072-9946</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/leeping">leeping</a><br>
<small>
Department of Chemistry, University of California, Davis, Califnornia 95616 USA
</small></p></li>
<li><p><strong>David L Mobley</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0002-1083-5533">0000-0002-1083-5533</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/davidlmobley">davidlmobley</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/davidmobley">davidmobley</a><br>
<small>
Departments of Pharmaceutical Sciences and Chemistry, University of California, Irvine, California 92697
· Funded by NIH R01GM132386
</small></p></li>
<li><p><strong>John D Chodera</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-0542-119X">0000-0003-0542-119X</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/jchodera">jchodera</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/jchodera">jchodera</a><br>
<small>
Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, New York 10065 USA; BIH Einstein Visiting Professor, Charité Universitätsmedizin, Berlin
· Funded by NSF CHE-1738979; NIH R01GM132386; NIH P30CA008748; Sloan Kettering Institute
</small></p></li>
</ul>
<h2 class="page_break_before" id="abstract">Abstract</h2>
<p>Accurate molecular mechanics force fields for small molecules are essential for predicting protein-ligand binding affinities in drug discovery and understanding the biophysics of biomolecular systems.
Torsion potentials derived from quantum chemical (QC) calculations are critical for determining the conformational distributions of small molecules, but are computationally expensive and scale poorly with molecular size.
To reduce computational cost and avoid the complications of distal through-space intramolecular interactions, molecules are generally fragmented into smaller entities to carry out QC torsion scans.
However, torsion potentials, particularly for conjugated bonds, can be strongly affected by through-bond chemistry distal to the torsion itself.
Poor fragmentation schemes have the potential to significantly disrupt electronic properties in the region around the torsion by removing important, distal chemistries, leading to poor representation of the parent molecule’s chemical environment and the resulting torsion energy profile.
Here we have show that a rapidly computable quantity, the fractional Wiberg bond order (WBO), is a sensitive reporter on whether the chemical environment around a torsion has been disrupted.
We show that the WBO can be used as a surrogate to assess the robustness of fragmentation schemes and identify conjugated bond sets.
We use this concept to construct a validation set by exhaustively fragmenting a set of druglike organic molecules and examine their corresponding WBO distributions derived from accessible conformations that can be used to evaluate fragmentation schemes.
To illustrate the utility of the WBO in assessing fragmentation schemes that preserve the chemical environment, we propose a new fragmentation scheme that uses rapidly-computable AM1 WBOs, which are available essentially for free as part of standard AM1-BCC partial charge assignment.
This approach can simultaneously maximize the chemical equivalency of the fragment and the substructure in the larger molecule while minimizing fragment size to accelerate QC torsion potential computation for small molecules and reducing undesired through-space steric interactions.</p>
<h2 id="introduction">1. Introduction</h2>
<p>Molecular mechanics (MM) small molecule force fields are essential to molecular design for chemical biology and drug discovery, as well as the use of molecular simulation to understand the behavior of biomolecular systems.
However, small molecule force fields have lagged behind protein force fields given the larger chemical space these force fields must cover to provide good accuracy over the space for druglike ligands, common metabolites, and other small biomolecules <span class="citation" data-cites="mbmV3Fg8 18mvPmwwB">[<a href="#ref-mbmV3Fg8" role="doc-biblioref">1</a>,<a href="#ref-18mvPmwwB" role="doc-biblioref">2</a>]</span>.
Torsion potentials for small molecule force fields are particularly problematic because historical approaches to their determination tend to produce parameters that generalize poorly <span class="citation" data-cites="13fQUQyf9">[<a href="#ref-13fQUQyf9" role="doc-biblioref">3</a>]</span>.
In particular, torsion potentials where the central bond is part of a conjugated system of bonds can be strongly influenced by distal substituents, an effect very difficult to represent in a force field using only local chemistry to define the parameters.
This lack of generalizability has led many practitioners to aim to improve the force field accuracy by refitting torsion parameters for individual molecules in a semi-automated bespoke fashion <span class="citation" data-cites="Io39j4ig 5cjbQnbG CstjV2w8">[<a href="#ref-Io39j4ig" role="doc-biblioref">4</a>,<a href="#ref-5cjbQnbG" role="doc-biblioref">5</a>,<a href="#ref-CstjV2w8" role="doc-biblioref">6</a>]</span>.
The added cost and time for this leads to a significant barrier to setting up simulations for new projects and may not produce generalizable parameters.</p>
<p>In many molecular mechanics force fields (such as Amber <span class="citation" data-cites="1GDaakPWY">[<a href="#ref-1GDaakPWY" role="doc-biblioref">7</a>]</span>, CHARMM <span class="citation" data-cites="11Z8pXbEW">[<a href="#ref-11Z8pXbEW" role="doc-biblioref">8</a>]</span>, OPLS <span class="citation" data-cites="Mi3Ujd07">[<a href="#ref-Mi3Ujd07" role="doc-biblioref">9</a>]</span>) a low-order Fourier series, such as a cosine series, is used to represent the contribution of torsion terms to the potential energy:</p>
<p><span id="eq:torsion" class="eqnos"><span class="math display">\[ E_{tor} = \sum_{n=1}^{N} \frac{V_n}{2}[1 + cos[n(\theta - \gamma)]]\]</span><span class="eqnos-number">(1)</span></span></p>
<p>Here, <span class="math inline">\(V_n\)</span> is the torsion force constant which determines the amplitudes, <span class="math inline">\(n\)</span> is the multiplicity which determines the number of minima, and <span class="math inline">\(\gamma\)</span> is the phase angle which is sometimes set to <span class="math inline">\(0^{\circ}\)</span> or <span class="math inline">\(180^{\circ}\)</span> to enforce symmetry around zero.
In most force fields, the maximum periodicity included is <span class="math inline">\(N = 4\)</span>, though some force fields feature up to <span class="math inline">\(N = 6\)</span>.
Torsion potential parameters, such as the amplitudes <span class="math inline">\(V_n\)</span> and phase angle <span class="math inline">\(\gamma\)</span>, are generally fit to the residual difference between a QC torsion energy profile (in the gas phase or implicit solvent) and the potential created by the non-torsion MM parameters <span class="citation" data-cites="i8ZZOoVS">[<a href="#ref-i8ZZOoVS" role="doc-biblioref">10</a>]</span>.
The QC torsion energy profile is generated by fixing the torsion angle and geometry optimizing all other atomic positions.</p>
<p>This simple Fourier expansion of a single torsion angle is only an approximation to the true Born-Oppenheimer surface; neighboring torsions can have correlated conformational preferences the low-order Fourier series does not capture <span class="citation" data-cites="SgTYwIda">[<a href="#ref-SgTYwIda" role="doc-biblioref">11</a>]</span>.
To account for this, 2D spline fits, such as the CMAP potential <span class="citation" data-cites="3fVo3EjD U4kYckJ1">[<a href="#ref-3fVo3EjD" role="doc-biblioref">12</a>,<a href="#ref-U4kYckJ1" role="doc-biblioref">13</a>]</span>, have become a popular way to model non-local correlations by fitting residuals between a 2D QC torsion energy profile of the coupled torsions of interest and the 2D MM torsion energy profile.</p>
<div id="fig:b3lyp_scaling" class="fignos">
<figure>
<img src="images/b3lyp-scaling.svg" alt="" /><figcaption><span>Figure 1:</span> <strong>Fragmenting molecules is necessary to avoid high computational cost of generating QC data.</strong>
<strong>[A]</strong> CPU time (wall clock time * nthreads) for a single QC gradient evaluation at B3LYP-D3(BJ)/DZVP level of theory <span class="citation" data-cites="YPDz9hB3 17YEERBX3">[<a href="#ref-YPDz9hB3" role="doc-biblioref">14</a>,<a href="#ref-17YEERBX3" role="doc-biblioref">15</a>]</span> vs number of heavy atoms in molecules.
All computations shown here were run on an Intel(R) Xeon(R) CPU E5-2697 v4 @ 2.30GHz.
Empirically, gradient evaluations grow as <span class="math inline">\(O(N^{2.6})\)</span> where <span class="math inline">\(N\)</span> is the number of heavy atoms.
The scaling is similar on other processors shown in SI Figures <a href="#fig:intel_scaling">12</a> &amp; <a href="#fig:amd_scaling">13</a>.
The black curves shows a power law fit to the data, while the grey curve depicts the 95% CI of the curve estimate.
<strong>[B]</strong> Smoothed histogram of heavy atoms in small molecules from DrugBank (~10,000 small molecules).
The average small molecule in DrugBank has 25 heavy atoms as shown with the grey line.</figcaption>
</figure>
</div>
<p>To produce a quantum chemical energy profile representing the chemical environment around the torsion, molecules are generally fragmented to smaller, model fragments and then capped with hydrogen or methyl groups for two main reasons described below.</p>
<ol type="1">
<li><strong>Computational efforts scale poorly with molecule size</strong>.
Generating 1D QC torsion profiles is computationally expensive, and becomes increasingly costly for larger molecules and/or higher dimensional QC torsion profiles.
QC calculations scale poorly with the number of basis sets <span class="math inline">\(N\)</span>, as <span class="math inline">\(O(N^M)\)</span>.
Formally, <span class="math inline">\(M\leq 4\)</span> for hybrid DFT, although modern implementations of hybrid DFT scale asymptotically as <span class="math inline">\(~N^{2.2-2.3}\)</span> <span class="citation" data-cites="I9yhXyTJ">[<a href="#ref-I9yhXyTJ" role="doc-biblioref">16</a>]</span>.
Using QCArchive data <span class="citation" data-cites="qXilVj0B v6Tvjyp5">[<a href="#ref-qXilVj0B" role="doc-biblioref">17</a>,<a href="#ref-v6Tvjyp5" role="doc-biblioref">18</a>]</span>, we found that empirically, hybrid DFT grows like <span class="math inline">\(~N^{2.6}\)</span> for the DZVP basis <span class="citation" data-cites="17YEERBX3">[<a href="#ref-17YEERBX3" role="doc-biblioref">15</a>]</span> as shown for gradient evaluations in Figure <a href="#fig:b3lyp_scaling">1</a>, A.
To achieve good sampling of the torsion profiles for adequate potential fits, constrained geometry optimizations need to be calculated at <span class="math inline">\(\leq 15^0\)</span> intervals, for a minimum of 24 constrained geometry optimizations for a 1D torsion profile.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
To avoid hysteresis in the energy profile due to orthogonal degrees of freedom <span class="citation" data-cites="1E3wArY0j">[<a href="#ref-1E3wArY0j" role="doc-biblioref">19</a>]</span>,
methods like wavefront propagation <span class="citation" data-cites="Kad6jO9v">[<a href="#ref-Kad6jO9v" role="doc-biblioref">20</a>]</span> are used.
This adds a factor of <span class="math inline">\(2 * D\)</span>, where <span class="math inline">\(D\)</span> is the dimension of the torsion scan, to the number of required optimizations.
We found (SI Figure <a href="#fig:opts_per_td">15</a>) that on average, ~60 QC optimizations are needed for a 1D wavefront-propagated torsion drive to converge, with ~20 gradient evaluations required per optimization (SI Figure <a href="#fig:grads_per_opt">14</a>).
Figure <a href="#fig:b3lyp_scaling">1</a>, B shows a smoothed histogram of the distribution of the number of heavy atoms in FDA approved small molecules taken from DrugBank <span class="citation" data-cites="1FI8iuYiQ">[<a href="#ref-1FI8iuYiQ" role="doc-biblioref">21</a>]</span>.
For an average druglike molecule of 25 heavy atoms (Figure <a href="#fig:b3lyp_scaling">1</a>, B), we can estimate the cost of a 1D torsion scan to be <span class="math inline">\(60 * 20 * 0.26 * 25^{2.6} \approx 1,000,000\)</span> CPU seconds.
Reducing the size of the molecule to be used in QC torsion drive computations to 15 heavy atoms would reduce the cost the torsion scan by an order of magnitude (<span class="math inline">\(60 * 20 * 0.26 * 15^{2.6} \approx 300,000\)</span> CPU seconds)</li>
</ol>
<ol start="2" type="1">
<li><strong>Intramolecular interactions complicate torsion drives and torsion parameter fitting</strong>
In larger molecules, there is a greater potential for long-range through-space intermolecular interaction (e.g hydrogen bonding) that should be captured by non-bonded parameters to contribute to the torsion profile.
This can be difficult to decouple from the 1-4 interactions that torsion parameters are supposed to capture.
While this can also happen in smaller molecules such as ethylene glycol <span class="citation" data-cites="Kad6jO9v">[<a href="#ref-Kad6jO9v" role="doc-biblioref">20</a>]</span> this problem is reduced when a minimal model molecule containing the model chemistry around the torsion is used, albeit not eliminated.</li>
</ol>
<p>While several algorithms for fragmenting large molecules into smaller molecular fragments have been previously proposed, few are appropriate for generating high-quality torsion scans.
Many of these algorithms fall into two categories:</p>
<ol type="1">
<li>fragmenting molecules for synthetic accessibility <span class="citation" data-cites="xbUA1nkO 15j2SwU5A 1BZlse7qR">[<a href="#ref-xbUA1nkO" role="doc-biblioref">22</a>,<a href="#ref-15j2SwU5A" role="doc-biblioref">23</a>,<a href="#ref-1BZlse7qR" role="doc-biblioref">24</a>]</span> and</li>
<li>fragmenting molecules to achieve linear scaling for QC calculations <span class="citation" data-cites="vm6HUPt4 ll3I4A87 nRywz8At EOlFsQFX">[<a href="#ref-vm6HUPt4" role="doc-biblioref">25</a>,<a href="#ref-ll3I4A87" role="doc-biblioref">26</a>,<a href="#ref-nRywz8At" role="doc-biblioref">27</a>,<a href="#ref-EOlFsQFX" role="doc-biblioref">28</a>]</span>.</li>
</ol>
<p>Fragmentation schemes for synthetic accessibility find building blocks for combinatorial and fragment-based drug design.
Cleavage happens at bonds where it makes sense for chemical reactions and does not consider how those cuts affect the electronic properties of the fragments.
For retrosynthetic applications, many cleavage points are at functional groups because those are the reactive sites of molecules.
However, for our application, we especially do not want to fragment at these reactive points given their likelihood of having strong electron-donating or withdrawing effects which in turn strongly impact the torsional potential targeted for parameterization.
Fragmentation algorithms for linear-scaling quantum chemical approaches such as Divide-and-Conquer methods <span class="citation" data-cites="F0de6fPE">[<a href="#ref-F0de6fPE" role="doc-biblioref">29</a>]</span>, effective fragment potential method <span class="citation" data-cites="EnOwBZmA">[<a href="#ref-EnOwBZmA" role="doc-biblioref">30</a>]</span>, and systematic molecular fragmentation methods <span class="citation" data-cites="EOlFsQFX">[<a href="#ref-EOlFsQFX" role="doc-biblioref">28</a>]</span> require the users to manually
specify where the cuts should be or which bonds not to fragment.
Furthermore, besides the scheme suggested by Rai et al. <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span>, none of these methods address the needs specific to fragmenting molecules for QC torsion scans for fitting MM force field parameters.
When fragmenting molecules for QC torsion scans, fragments need to include all atoms involved in 1-4 interactions, since they are incorporated in the fitting procedure.
We also need a systematic way to determine if remote substituents significantly alter the barrier to rotation around the central torsion bond.</p>
<p>In this work, we use the Wiberg Bond Order (WBO) <span class="citation" data-cites="BES2Ksiq">[<a href="#ref-BES2Ksiq" role="doc-biblioref">32</a>]</span>, which is both simple to calculate from semi-empirical QC methods and is sensitive to the chemical environment around a bond <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>.
WBOs quantify electron population overlap across bonds or the degree of bonding between atoms.
Bond orders are correlated with bond vibrational frequencies <span class="citation" data-cites="hHhjgmIm 14qKIxxbD">[<a href="#ref-hHhjgmIm" role="doc-biblioref">34</a>,<a href="#ref-14qKIxxbD" role="doc-biblioref">35</a>]</span> and WBOs are used to predict trigger bonds in high energy-density material because they are correlated with the strength of bonds <span class="citation" data-cites="cAeBUxqm">[<a href="#ref-cAeBUxqm" role="doc-biblioref">36</a>]</span>, a property which also directly affects the torsion potential.
Wei et al. <span class="citation" data-cites="fpE0Y69s">[<a href="#ref-fpE0Y69s" role="doc-biblioref">37</a>]</span> have shown that simple rules for electron richness of aromatic systems in biaryls are a good indication of torsion force constants (specifically for V<sub>2</sub> in equation <a href="#eq:torsion">1</a>); however, this measure was only developed for biaryls and it does not take into account substituents beyond the aromatic ring directly adjacent to the bond.</p>
<p>Here, we develop an approach that uses the WBO to validate whether a fragmentation scheme significantly alters the local chemical environment of interest, with a particular focus on fragmentation schemes suitable for QC torsion drives.
Our approach uses simple heuristics to arrive at a minimal fragment for QC torsion scan that is representative of the torsion environment of the substructure in the parent molecule:
For a central bond, all atoms that are involved in the local steric interactions of a torsion scan are included, and then the WBO is used as a surrogate to determine if the fragment needs to be expanded to preserve the correct electronics around the central bonds.</p>
<p>The paper is organized as follows:
Section 2 provides a mathematical and physical description of the problem of fragmenting molecules for QC torsion scans.
Section 3 provides the motivation for using the WBO as a surrogate, evaluates its robustness, proposes a minimal
fragmentation scheme, and describes a rich validation set that can be used to benchmark fragmentation schemes.
Section 4 provides a discussion of the implications of this study, and Section 5 describes the detailed methods used here.</p>
<h2 id="theory-and-definitions">2. Theory and definitions</h2>
<h3 id="a-mathematical-definition-of-the-problem-of-fragmenting-molecules-for-qc-torsion-drives">2.1 A mathematical definition of the problem of fragmenting molecules for QC torsion drives</h3>
<p>A molecular structure can be modeled as a degree-bounded graph <span class="math inline">\(G = (V, E)\)</span>, where <span class="math inline">\(V\)</span> are the nodes and <span class="math inline">\(E\)</span> are the edges.
In a molecular graph, the nodes correspond to atoms and edges correspond to covalent bonds.
We define rotatable bonds as a set of bonds in the molecule that are not in rings, <span class="math inline">\(\mathcal{E} \subset E\)</span>, and <span class="math inline">\(\mathcal{G}\)</span> as a set
of allowable subgraphs, where each subgraph <span class="math inline">\(G&#39;(V&#39;, E&#39;) \in \mathcal{G}\)</span> is built around a central, rotatable bond, <span class="math inline">\(e&#39; \in \mathcal{E}\)</span>
with the following conditions:</p>
<ul>
<li>The number of atoms in <span class="math inline">\(G&#39;\)</span>, <span class="math inline">\(|V&#39;|\)</span>, are <span class="math inline">\(4 \leq |V&#39;| \leq |V|\)</span></li>
<li>The minimum edges in <span class="math inline">\(G&#39;\)</span> are <span class="math inline">\(e&#39;\)</span> and all <span class="math inline">\(e \in E\)</span> such that <span class="math inline">\(e, e&#39;\)</span> share a vertex</li>
<li>All <span class="math inline">\(v \in V\)</span> adjacent to <span class="math inline">\(e\)</span> are included in <span class="math inline">\(G&#39;\)</span></li>
<li>If <span class="math inline">\(v \in V&#39;\)</span> is in a ring in <span class="math inline">\(G\)</span>, the ring should be included in <span class="math inline">\(G&#39;\)</span></li>
</ul>
<p>The weights on <span class="math inline">\(e&#39;\)</span> are given by <span class="math inline">\(\delta(e&#39;; G&#39;)\)</span>, where <span class="math inline">\(\delta\)</span> is the RMSE of the torsion potential around the central, rotatable bond in the full graph <span class="math inline">\(G\)</span> compared to the subgraph <span class="math inline">\(G&#39;\)</span>.
Since <span class="math inline">\(\delta(e&#39;; G&#39;)\)</span> is computationally expensive to evaluate, we use a surrogate, <span class="math inline">\(\gamma(e&#39;; G&#39;)\)</span>, which we define as the difference of the WBO on the central, rotatable bond <span class="math inline">\(e&#39;\)</span> in <span class="math inline">\(G&#39;\)</span> and in the full graph <span class="math inline">\(G\)</span>.
In order to calculate the WBO, we need to “cap” open valences by adding additional atoms to ensure the resulting molecule is not a radical.
The rules we use are defined in Section 3.4.</p>
<p>We want to minimize <span class="math inline">\(\gamma(e&#39;; G&#39;)\)</span>, while also minimizing the cost of each subgraph.
We define the cost as estimated in Figure <a href="#fig:b3lyp_scaling">1</a></p>
<p><span class="math display">\[ c(G&#39;) \propto (|V&#39;|)^{2.6} \]</span></p>
<p>which leads to minimizing</p>
<p><span class="math display">\[ \sum_{e&#39; \in \mathcal{E}} |\gamma(e&#39;;  G&#39;) + c(G&#39;; e&#39;)|\]</span></p>
<p>The search space of <span class="math inline">\(\mathcal G\)</span> for each rotatable bond is combinatorial, and its upper bound is <span class="math inline">\({|V|\choose{4}} + {|V|\choose{5}} + ... {|V|\choose{|V|}}\)</span> since all <span class="math inline">\(G&#39; \in \mathcal G\)</span> need to be connected and rings are not fragmented.
To reduce the search space, we also define a list of functional groups that should not be fragmented in Table <a href="#tbl:fgroups">1</a>.</p>
<p>Given how large the search space can become, we use several heuristics, described in Section 3.4.</p>
<h3 id="physical-definitions">2.2 Physical definitions</h3>
<p>In most MM force fields, atom types are used to encode the local chemical environment of atoms for which parameters are assigned to <span class="citation" data-cites="mbmV3Fg8">[<a href="#ref-mbmV3Fg8" role="doc-biblioref">1</a>]</span>.
This allows parameters developed for one atom to be transferred to another atom in a similar chemical environment.
However, since atom types are locally defined, they do not always capture long-range effects such as conjugation.
This is especially problematic for torsions since the torsion energy function (or profile) of a bond is determined by a combination of local and non-local effects from conjugation, hyperconjugation, sterics, and electrostatics <span class="citation" data-cites="fpE0Y69s AWj8hnbG Vx7ALVw2 1DVkKVgPL">[<a href="#ref-fpE0Y69s" role="doc-biblioref">37</a>,<a href="#ref-AWj8hnbG" role="doc-biblioref">38</a>,<a href="#ref-Vx7ALVw2" role="doc-biblioref">39</a>,<a href="#ref-1DVkKVgPL" role="doc-biblioref">40</a>]</span>.
In this study, we define <em>local atoms</em> as those within two bonds of the central bond of a torsion, and <em>remote atoms</em> as any atom beyond those two bonds.</p>
<p>Steric and electrostatic interactions are, in principle, accounted for by non-bonded terms in most force fields, so a torsion profile would ideally primarily capture conjugation or hyperconjugation, and only the 1-4 nonbonded effects.
Using small fragments to generate QC torsion profiles reduces non-local electrostatics and steric interactions from contributing to the torsion profile.
However, conjugation and hyperconjugation are non-local properties and remote chemical changes can influence the extent of conjugation and/or hyperconjugation.
In this study, we aim to avoid removing remote chemical substituents that impact the torsion of interest via conjugation and hyperconjugation by first understanding how the strength of the central bond is altered by remote chemical modifications.
Below, we give a more precise definition of <em>conjugation</em> and <em>hyperconjugation</em> and how we use these terms in this paper.</p>
<p>Conjugation and hyperconjugation describe the sharing of electron density across several bonds.
Conjugation is formally defined as the overlap of p-orbital electrons across <span class="math inline">\(\sigma\)</span> bonds <span class="citation" data-cites="brHoyaiC 10vgXCYFf">[<a href="#ref-brHoyaiC" role="doc-biblioref">41</a>,<a href="#ref-10vgXCYFf" role="doc-biblioref">42</a>]</span>, such as what occurs in benzene or butadiene.
Hyperconjugation is the interaction of electrons in a donating bonding orbital to an anti-bonding orbital <span class="citation" data-cites="l3TAWQJ6">[<a href="#ref-l3TAWQJ6" role="doc-biblioref">43</a>]</span>.
In this study, for simplicity, we use the term conjugation to refer to all modes of conjugation and hyperconjugation.</p>
<h2 id="results-and-discussion">3. Results and Discussion</h2>
<h3 id="fragmenting-molecules-for-quantum-chemical-torsion-scans-can-alter-the-chemical-environment-of-the-torsion.">3.1 Fragmenting molecules for quantum chemical torsion scans can alter the chemical environment of the torsion.</h3>
<div id="fig:biphenyls" class="fignos">
<figure>
<img src="images/figure-2.svg" alt="" /><figcaption><span>Figure 2:</span> <strong>Torsion profiles can be sensitive to small local and remote chemical changes.</strong>
[<strong>A</strong>] QC torsion scans of the central bond in biphenyls in different protonation states. The colors of the QC torsion scans
correspond to the highlighted central bond of the biphenyls. The Wiberg bond order is shown in the box next to the central bond.
[<strong>B</strong>] Same as <strong>A</strong> but with fluorine on the ortho position.
[<strong>C</strong>] Same as <strong>A</strong> but with Chlorine on the ortho position</figcaption>
</figure>
</div>
<p>Small chemical changes to molecules, both local and remote, can drastically alter their electronic properties.
This poses a challenge to force field parametrization, specifically that of torsion parameters which rely on computationally expensive QC torsion scans for reference data [cite rowley preprint].
Given how poorly QC torsion scans scale with molecular size, molecules are fragmented to smaller entities to generate the reference data.
The assumption is that torsion scans generated for substructures can be used as reference data for other molecules that share the substructure.
However, seemingly similar torsion types in different chemical environments can have very different torsion potential.
This is particularly apparent in conjugated systems where small, remote changes can exert strong electron-donating or -withdrawing effects thus altering torsional barrier heights as we have shown <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>.
When such remote changes are combined with other more local changes that induce both electronic effects and steric clashes, remote effects can be either amplified or counteracted.</p>
<p>We illustrate such changes in an example as shown in Figure <a href="#fig:biphenyls">2</a>.
Figure <a href="#fig:biphenyls">2</a> A shows a series of biphenyls in different protonation states.
The central bond in the biphenyls are part of a larger conjugated system.
However, the extent of conjugation changes with small, remote chemical changes.
This is reflected both in the increased barrier heights of the torsion scans and increased Wiberg bond order of the bond.
As the extent of conjugation increases, the Wiberg bond order, or electronic population overlap increases, and resistance to rotation increases as reflected in increasing torsion barrier heights.
For <a href="#fig:biphenyls">2</a> A, the remote change exerts a very strong effect on the central bond.
This effect decreases with small local chemical changes that induce steric effects as shown in <a href="#fig:biphenyls">2</a> B and C.
When halogens, which are larger than hydrogens, are placed in the ortho position, the local steric effect increases the energy of the planar conformation needed for conjugation which counteracts the remote effects.
Thus, while the energy barrier and WBOs increase for the cation, anion and zwitterion, the changes are less drastic for larger substituents at the ortho position.
Figure <a href="#fig:biphenyls">2</a> C shows the series of torsion scans for chloro-pyridyl-phenol.
While the torsion barrier heights increase as the WBO increase, the increase is less drastic as the flouro-pyridyl-phenol series (Figure <a href="#fig:biphenyls">2</a> B) because chlorine is larger than fluorine.</p>
<p>The trends shown in this example illustrate why fragmenting molecules appropriately for QC torsion scans currently still requires human expertise and is difficult to automate.
In these cases, small remote changes gradually perturbed the conjugation of the central bond.
In addition, these changes were different for similar molecules with different local environments.
When fragmenting molecules, we aim to avoid destroying a bond’s chemical environment by naively removing an important remote substituent.</p>
<h3 id="a-simple-fragmentation-scheme-can-use-the-wbo-to-preserve-the-chemical-environment-around-a-torsion">3.2 A simple fragmentation scheme can use the WBO to preserve the chemical environment around a torsion</h3>
<div id="fig:frag_scheme" class="fignos">
<figure>
<img src="images/fragmentation_scheme.svg" alt="" /><figcaption><span>Figure 3:</span> <strong>Illustration of fragmentation scheme using WBOs.</strong>
First, we find the rotatable bonds and calculate their ELF10 WBOs.
Then, for each rotatable bond, we generate the minimal fragment about each rotatable bond as described in the text (Section 3.4).
We then compute ELF10 WBOs for the central torsion bonds around which the minimal fragments were generated and check if the new ELF10 WBO is within the disruption threshold relative to the parent’s LEF10 WBO.
If the absolute difference is greater than the disruption threshold, substituents are added, one at a time, and the ELF10 WBO is recalculated. The red circle illustrates such a fragment.
The absolute difference of its WBO relative to the parent (0.99 in the minimal fragment vs 1.09 in the parent molecule) is greater than the disruption threshold of 0.03.
The fragment continues to grow until the central bond’s ELF10 WBO is within the disruption threshold of the ELF10 WBO of the bond in the parent molecule.
The green circle illustrates the better, larger fragment that has an ELF10 WBO on its central bond closer to the ELF10 WBO on the same bond in the parent molecules.</figcaption>
</figure>
</div>
<p>The WBO is a robust indicator of changes in torsion energy barrier heights for related torsions <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>.
Therefore, if a fragment’s WBO deviates too much from its parent WBO at the same bond, the fragmentation is probably inadequate.
Using this concept, we extended the fragment-and-cap scheme proposed by <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span> by considering resonance via WBOs.
The fragment-and-cap scheme generates minimal torsion fragments that include the four torsion atoms and the relevant neighboring atoms that define the local chemical environment <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span>.
While the scheme captures the local chemical environment, it sometimes does not adequately capture through-bond non-local effects, specifically when extended conjugated systems are involved.
We extend the scheme to include the remote substituents that contribute to the electronic overlap across the central torsion bonds by using the WBO as indicators of how well the chemical environment was preserved.</p>
<p>However, WBOs are conformation-dependent <span class="citation" data-cites="r3xLNmRT">[<a href="#ref-r3xLNmRT" role="doc-biblioref">44</a>]</span> which can result in different fragments if the conformations change.
Therefore, we use the Electronically Least-Interacting Functional groups (ELF10) WBOs, a method available in the OpenEye toolkit <code>quacpac</code> <span class="citation" data-cites="16hZpgNca">[<a href="#ref-16hZpgNca" role="doc-biblioref">45</a>]</span> that generates WBOs that are relatively insensitive to the initial conformation.
But since conformation-dependent variance of WBO distributions are higher for conjugated bonds, we can then use the conformation-dependent distribution of WBOs over conformation to asses whether the chemical environment has been significantly perturbed as described in more detail in section 3.3.</p>
<p>The scheme, illustrated in Figure <a href="#fig:frag_scheme">3</a> is as follows:</p>
<ol type="1">
<li>Find acyclic bond. For this step we use the SMARTS pattern <code>[!$(*#*)&amp;!D1]-,=;!@[!$(*#*)&amp;!D1]</code>.</li>
<li>Keep the four atoms in the torsion quartet and all atoms bonded to those atoms. This ensures that all 1-5 atoms are included in the minimal fragment.</li>
<li>If any of the atoms are part of a ring or functional group shown in Table <a href="#tbl:fgroups">1</a>, include ring and functional groups atoms to avoid ring breaking and fragmenting functional groups that contain more than one heteroatom.
The list in Table ?? are the functional groups that were present in the validation and is therefor not exhaustive.</li>
<li>Keep all ortho substitutents relative to the torsion quartet atoms.</li>
<li>N, O and S are capped with methyl. All other open valence atoms are capped with hydrogen.</li>
<li>Calculate ELF10 WBO for fragment.</li>
<li>If the fragment’s ELF10 WBO differs by more than a user defined threshold, continue grow out one bond at a time until the
fragment’s ELF10 WBO is within the threshold of the parent ELF10 WBO.</li>
</ol>
<div id="tbl:fgroups" class="tablenos">
<table>
<caption><span>Table 1:</span> <strong>Functional groups kept whole during fragmentation.</strong>
This list includes functional groups that were present in the validation set.
Users can add their own functional groups they do not want to fragment. </caption>
<thead>
<tr class="header">
<th>Chemical group</th>
<th>SMARTS pattern</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>hydrazine</td>
<td><code>[NX3][NX3]</code></td>
</tr>
<tr class="even">
<td>hydrazone</td>
<td><code>[NX3][NX2]</code></td>
</tr>
<tr class="odd">
<td>nitric oxide</td>
<td><code>[N]-[O]</code></td>
</tr>
<tr class="even">
<td>amide</td>
<td><code>[#7][#6](=[#8])</code>, <code>[#7][#6](-[O-])</code></td>
</tr>
<tr class="odd">
<td>urea</td>
<td><code>[NX3][CX3](=[OX1])[NX3]</code></td>
</tr>
<tr class="even">
<td>aldehyde</td>
<td><code>[CX3H1](=O)[#6]</code></td>
</tr>
<tr class="odd">
<td>sulfoxide</td>
<td><code>[#16X3]=[OX1]</code>, <code>[#16X3+][OX1-]</code></td>
</tr>
<tr class="even">
<td>sulfonyl</td>
<td><code>[#16X4](=[OX1])=([OX1])</code></td>
</tr>
<tr class="odd">
<td>sulfinic acid</td>
<td><code>[#16X3](=[OX1])[OX2H,OX1H0-]</code></td>
</tr>
<tr class="even">
<td>sulfinamide</td>
<td><code>[#16X4](=[OX1])=([OX1])([NX3R0])</code></td>
</tr>
<tr class="odd">
<td>sulfonic acid</td>
<td><code>[#16X4](=[OX1])(=[OX1])[OX2H,OX1H0-]</code></td>
</tr>
<tr class="even">
<td>phosphine oxide</td>
<td><code>[PX4](=[OX1])([#6])([#6])([#6])</code></td>
</tr>
<tr class="odd">
<td>phosphonate</td>
<td><code>P(=[OX1])([OX2H,OX1-])([OX2H,OX1-])</code></td>
</tr>
<tr class="even">
<td>phosphate</td>
<td><code>[PX4](=[OX1])([#8])([#8])([#8])</code></td>
</tr>
<tr class="odd">
<td>carboxylic acid</td>
<td><code>[CX3](=O)[OX1H0-,OX2H1]</code></td>
</tr>
<tr class="even">
<td>nitro</td>
<td><code>([NX3+](=O)[O-])</code>, <code>([NX3](=O)=O)</code></td>
</tr>
<tr class="odd">
<td>ester</td>
<td><code>[CX3](=O)[OX2H0]</code></td>
</tr>
<tr class="even">
<td>tri-halides</td>
<td><code>[#6]((([F,Cl,I,Br])[F,Cl,I,Br])[F,Cl,I,Br])</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="fragmentation-schemes-can-be-assessed-by-their-ability-to-preserve-the-chemical-environment-while-minimizing-fragment-size">3.3 Fragmentation schemes can be assessed by their ability to preserve the chemical environment while minimizing fragment size</h3>
<p>This fragmentation scheme elaborates upon the method proposed in <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span> to remedy deficiencies that will be addressed in more detail in section 3.3.2.
However, there are some adjustable hyperparameters.
In order to asses various thresholds and different fragmentation schemes in general, we generated a diverse subset of FDA-approved drug molecules that can be a useful validation set.
The goal of this set was to find molecules that are challenging to fragment, such that the molecules in this set have bonds that are sensitive to remote substituent changes.
In other words, we sought to create a set which is particularly difficult for conventional techniques to fragment well in order to test our method.
To find these molecules, we first filtered DrugBank (version 5.1.3 downloaded on 2019-06-06) <span class="citation" data-cites="1FI8iuYiQ">[<a href="#ref-1FI8iuYiQ" role="doc-biblioref">21</a>]</span> with the following criteria:</p>
<ol type="1">
<li>FDA-approved small molecules</li>
<li>Largest ring size has less than 14 heavy atoms</li>
<li>Smallest ring size has at least 3 heavy atoms</li>
<li>Molecule has less than 10 rotatable bonds</li>
<li>Molecule must have at least one aromatic ring</li>
<li>Molecule has only one connected component</li>
</ol>
<div id="fig:validation_set_rep" class="fignos">
<figure>
<img src="images/representative_molecules.svg" alt="" /><figcaption><span>Figure 4:</span> <strong>Representative diverse drug-like molecules used to generate the validation set.</strong>
Twenty representative molecules in the validation set after filtering DrugBank shown here to illustrate the diversity
of the set.</figcaption>
</figure>
</div>
<p>This left us with 730 small molecules.
Representative molecules are shown in Figure <a href="#fig:validation_set_rep">4</a>.
Charged molecules exacerbate remote substituent sensitivity and many molecules are in charged states at physiological pH.
To ensure that our dataset is representative of drugs at physiological pH, we used the OpenEye <code>EnumerateReasonableTautomers</code> to generate tautomers that are likely significantly populated at pH ~7.4 <span class="citation" data-cites="16hZpgNca">[<a href="#ref-16hZpgNca" role="doc-biblioref">45</a>]</span>. This tautomer enumeration extended the set to 1289 small molecules.
We then generated all possible fragments of these molecules by using a combinatorial fragmentation scheme.
In this scheme, every rotatable bond is fragmented and then all possible connected fragments are generated where the smallest fragment has 4 heavy atoms and the largest fragment is the parent molecule.
This scheme generated ~300,000 fragments.</p>
<p>To asses how much the chemical environments were perturbed in these fragments, we generated conformation-dependent WBO distributions for every fragment and compared them to the parents’ WBO distributions.
Using the conformation-dependent WBO distributions rather than ELF10 WBOs for assessment allowed us to more fully capture the bonds’ chemical environment because changes in variance are also indicative of change in conjugation <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>.
For each fragment, OpenEye Omega <span class="citation" data-cites="1G1ccz54w">[<a href="#ref-1G1ccz54w" role="doc-biblioref">46</a>]</span> was used to generate conformers and the AM1 WBO was calculated for every bond in every conformer.
This resulted in a distribution of WBOs for all bonds in all fragments.
The resulting dataset captures both obvious and subtle through-bond non-local chemical changes.</p>
<div id="fig:dabrafenib_wbo_dists" class="fignos">
<figure>
<img src="images/exhaustive-fragmentation.svg" alt="" /><figcaption><span>Figure 5:</span> <strong>Truncating critical chemical substituents leads to significant changes in the WBO distributions.</strong>
<strong>[A]</strong> An illustrative example of the shift in the conformational-dependent WBO distributions due to crucial chemical changes such as
the loss of fluorine.
The distributions are shaded with their corresponding distance score shown in the color bar on the right.
The parent molecule’s WBO distribution (numbered 4) is shaded red.
Selected distributions are outlined and the corresponding fragments are shown in <strong>C</strong>.
<strong>[B]</strong> Computational cost of fragment (NHeavy<sup>2.6</sup>) vs distance score (Maximum Mean Discrepancy, Equation <a href="#eq:mmd_sqrd">2</a>) of the fragment indicates that it is possible to reduce the cost of torsion scans without destroying the torsion profile.
The black line is the Pareto front, or the most computational inexpensive fragment with the best score at that size.
The selected fragment should be on the Pareto front at the lower left corner.
<strong>[C]</strong> Selected fragments. Bonds are highlighted with their distance score.
The ELF10 WBO is shown in the boxes above the highlighted bonds.</figcaption>
</figure>
</div>
<p>Figure <a href="#fig:dabrafenib_wbo_dists">5</a> shows an example of the results of exhaustive fragmentation and how this data can be used to benchmark fragmentation schemes.
The parent molecule, Dabrafenib (Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, C 4) was fragmented at all rotatable bond which resulted in 11 fragments (in this example, the trimethyl was not fragmented).
Of these fragments, all connected combinations were generated resulting in 108 connected fragments.
Of those 108 fragments, 44 fragments contained the bond between the sulfur in the sulfonamide and phenyl ring highlighted in fragments in Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, C.</p>
<p>When the WBOs were calculated for all Omega generated conformers for each of the 44 fragments, the resulting WBO distributions clustered into 4 bins as illustrated with the color and location of the distributions in Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, A.
The shifts of the distributions corresponded to specific remote substituent changes—in this case, the loss of fluorine of the ring bonded to the sulfur and the phenyl ring bonded to the nitrogen in the sulfonamide.
Excluding the flourine on the other ring (bonded to the nitrogen) does not influence this metric as seen by the significant overlap between the WBO distribution of the parent and fragment 3 in Figure <a href="#fig:dabrafenib_wbo_dists">5</a> A.
Here, these two changes cause the distributions to shift in opposite directions.
While the loss of a fluorine on the phenyl bonded to the sulfur shifts the distribution to the right, the loss of the ring bonded to the nitrogen shifts the distributions to the left illustrating that the changes can counteract each others.
Fragments 2, 3, 4, and 6 (Figure <a href="#fig:dabrafenib_wbo_dists">5</a>C) all contain two fluorine and the phenyl bonded to the nitrogen and fall in the same cluster as the parent molecule, regardless if the rest of the molecule is included in the fragment.
Fragments 7 and 9 only have one fluorine on the phenyl ring and both of their distributions are shifted to the right relative to the parent WBO distribution.
Fragments 10 and 11 have no fluorine on the ring and are shifted to the right even further.
Since removing the ring bonded to the nitrogen shifts the WBO distribution in the opposite direction,
fragment 1, while having two fluorine, is shifted to the left of the parent distribution, fragment 5 WBO distribution overlaps with the parent WBO distribution even if it only has one fluorine, and fragment 8 is only shifted slightly to the right of the parent WBO distribution with no fluorine.</p>
<h4 id="wbo-distributions-can-measure-how-well-fragments-preserve-the-chemical-environment-around-the-torion">3.3.1 WBO distributions can measure how well fragments preserve the chemical environment around the torion</h4>
<p>Each fragment needs to be assigned a score of how well is preserves its parent chemical environment.
To score each fragment, we compare the conformer dependent WBO distribution for a bond in a fragment against the WBO conformer-dependent distribution of the same bond in the parent molecule.
To compare these distributions, we compute the maximum mean discrepancy (MMD) <span class="citation" data-cites="rvZRlbML">[<a href="#ref-rvZRlbML" role="doc-biblioref">48</a>]</span> for the fragment distribution to the parent as follows:</p>
<p><span class="math display">\[\begin{equation} MMD(P, Q) = \| \mathbb{E}_{X\sim P}[\varphi(X)] - \mathbb{E}_{Y\sim Q}[\varphi(Y)]\|_{\mathcal{H}} \end{equation}\]</span></p>
<p>where the feature map <span class="math inline">\(\varphi: \mathcal{X} \rightarrow \mathcal{H}\)</span> we use is squared <span class="math inline">\(\varphi(x) = (x, x^2)\)</span> and the
MMD becomes:</p>
<p><span id="eq:mmd_sqrd" class="eqnos"><span class="math display">\[MMD = \sqrt{(\mathbb{E}[X]-\mathbb{E}[Y])^2 + (\mathbb{E}[X^2] - \mathbb{E}[Y^2])^2}\]</span><span class="eqnos-number">(2)</span></span></p>
<p>where [X] is the expected value of the parent WBO and [Y] is the expected value of fragment WBO.
Including the squared mean incorporates the second moment of the distribution and helps distinguish distributions both with different means and variances.
It is important to incorporate changes in variance given how the variance of the WBO distributions change for different chemical environments <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>.
In general, changes in WBO distribution variance corresponds to changes in relative torsion barrier heights <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>.</p>
<p>In Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, the MMD which we refer to distance score is shown with the color map.
The distributions in Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, A are shaded with the distance score.
The scores clearly differentiates the shifted distributions.</p>
<h4 id="good-fragmentation-schemes-minimize-both-chemical-environment-disruption-and-fragment-size">3.3.2 Good fragmentation schemes minimize both chemical environment disruption and fragment size</h4>
<p>The goal of our fragmentation scheme is to find fragments that have a WBO distribution of the bond of interest closest the the parent while minimizing the computational cost of the fragment.
We estimate the computational cost of a fragment as NHeavy<sup>2.6</sup> as shown in Figure <a href="#fig:b3lyp_scaling">1</a> A.
The distance score calculated with MMD indicates how far the fragment’s WBO distribution is or how much the chemical environment changed from its parent.
When we plot the fragment size against this score, the points that fall on the Pareto front <span class="citation" data-cites="8Fq6BXg5">[<a href="#ref-8Fq6BXg5" role="doc-biblioref">49</a>]</span> are the ones where the distance score is the best for for a given fragment size or vice versa.</p>
<p>Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, B shows an illustrative example of this.
The Pareto front is shown with a black line and the fragment data points on the front are indicated with a black circles.
The numbers on the annotated data points correspond the the numbered fragments in Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, C.
Fragment 6 is the smallest fragment with the shortest distance to the parent molecule.
It has the important chemical moieties, such as all three fluorine and the ring bonded to the nitrogen.
While fragments 2 and 5 are also on the Pareto front, the missing ring and fluorine increase the distance score, however, it is not clear if this difference is significant.</p>
<p>Fragment 3, which is missing the fluorine on the ring bonded to the nitrogen, is shifted in the distance score relative to the parent by the same amount as fragment 2 is from 6, even if it has all other parts of the molecule.
Both the chemical change and shift in distance scores are small, but they are consistent for both larger and smaller fragments.
adding credence to the fact that the small difference in the distance score does pick up on this chemical change.
Fragments 7 and 11 illustrate that having larger fragments will not improve the distance score if the important remote substituents are not present in the fragment.
Fragment 9, while significantly smaller than fragment 7, has the same distance score because they both are missing the important fluorine.
Fragments 10 and 11 show the same trend for the fragments missing both fluorine.
While fragments 1, 5, and 8 are all small, the loss of the ring results in larger distance scores.</p>
<p>The goal of any fragmentation scheme is to find fragments on the Pareto front that minimize both the changes in the chemical environment of the bond and fragment size.
In other words, they should be on the lower left corner of the plot.</p>
<p>To assess the quality our fragmentation scheme, we wanted to find the molecules that are challenging to fragment.
To do that, we defined a bond sensitivity score as follows.
For each bond, find all fragments from the exhaustive fragmentation experiment that include the bond, calculate the distance score to the parent, and find the fragment with the maximum distance.
This maximum distance score is the sensitivity score of the bond.
This is a good indication of a bond’s sensitivity to removal of remote substituents because the more its WBO distribution shifts relative to the parent when fragmented, the more the electronic population overlap around that bond changes with remote chemical changes.
We then chose the top 100 molecules that had bonds where fragments that included all 1-5 atoms around the central bond had the highest sensitivity scores
Selected molecules with bonds highlighted according to their sensitivity are shown in Figure <a href="#fig:validation_set">6</a>.
The rest of the molecules are shown in SI Figure <a href="#fig:full_validation_set">16</a>.
This set included many molecules in charged states.</p>
<div id="fig:validation_set" class="fignos">
<figure>
<img src="images/figure-10_inkscape.svg" alt="" /><figcaption><span>Figure 6:</span> <strong>Some bonds are more sensitive to removal of remote substituents and are therefore challenging to fragment.</strong>
Selected molecules of the validation set are shown to illustrate differential bond sensitivity to remote substituent changes.
Bonds are highlighted by how sensitive they are to remote substituent changes as quantified by the bond sensitivity score.
The bond sensitivity score is defined as the maximum distance score of that bond in different fragments as defined in the text.
(see Figure <a href="#fig:dabrafenib_wbo_dists">5</a> A and B).
Fragments used to get the maximum distances include all 1-5 atoms around the highlighted bonds.
Molecules 10-12 also show
the atoms the bonds are sensitive to.
The atoms are circled with the same color as the bond that is sensitive to it.
The rest of the molecules used in the validation set are shown in SI Figure <a href="#fig:full_validation_set">16</a></figcaption>
</figure>
</div>
<p>Not all bonds are equally sensitive to such changes.
This is shown by the magnitude by which the sensitivity score varies for bonds within the same molecule as shown in Figure <a href="#fig:validation_set">6</a>.
The general trend observed is that conjugated bonds,
and bonds including atoms with lone pairs such as N, O, and S, are more sensitive to peripheral cuts.
Molecules 10-12 (Figure <a href="#fig:validation_set">6</a>) also show which chemical moiety the bond is sensitive to, indicated by circles around the atoms which are colored with the corresponding bond’s sensitivity score.
In molecule 10, the WBO distribution of the amide bond shifts significantly if the positively charged nitrogen is remove regardless if the rest of the molecule is intact (data not shown).
In molecule 11, the removal of the phosphate group shifts the distribution of the red bond.
In molecule 12, both the amide and ester bond are sensitive to the same negatively charged oxygen indicated by two circles around the oxygen.</p>
<div id="fig:joint_plots" class="fignos">
<figure>
<img src="images/cost-vs-accuracy.svg" alt="" /><figcaption><span>Figure 7:</span> <strong>Different WBO disruption thresholds result in different accuracy vs cost trade-offs.</strong>
Computational cost vs distance score of the fragments for the bonds in the benchmark set shown in Figure <a href="#fig:full_validation_set">16</a>.
Computational cost is proportional to NHeavy<sup>2.6</sup> as estimated in Figure <a href="#fig:b3lyp_scaling">1</a>, A.
The threshold is the maximum amount of change allowed in the ELF10 WBO relative to the parent molecules’s ELF10 WBO during fragmentation.</figcaption>
</figure>
</div>
<p>We aim to identify parameters for our fragmentation scheme that maximize the number of fragments that end up in that lower left corner of the Pareto front (illustrated in Figure <a href="#fig:dabrafenib_wbo_dists">5</a>, B).
To do that, we generated fragments for the highly sensitive bonds in the 100 molecules shown in SI Figure <a href="#fig:full_validation_set">16</a> using different disruption thresholds.
For every fragment, we found the distance score of their fragments’ WBO distribution and their computational cost.
We then plotted all fragments from the validation set for different thresholds (Figure <a href="#fig:joint_plots">7</a>).
When the threshold is low, the fragmentation scheme will generate fragments which have very good distance scores, but many of them will be too big for computationally efficient QC torsion scan.
On the other hand, when the disruption threshold is too low, the scheme generates fragments that are small but the distance scores are too big.
For the molecules we tested, a threshold of 0.03 leads to the most fragments in the lower left quadrant (defined as cost &lt; 4000 seconds per gradient evaluation and score &lt; 0.05) as shown in Table <a href="#tbl:benchmark">2</a>.</p>
<p>This threshold is similar to what we found when we looked at the distribution of standard deviations for WBO distributions with respect to conformations (Figure ??, blue).
Most of them fall under 0.03.
Both of these data points lead us to recommend a WBO disruption threshold of 0.03 for our fragmentation scheme.
While the current scheme does not provide a perfect solution, plots in Figure <a href="#fig:joint_plots">7</a> shows fewer fragments outside of the lower left region for thresholds 0.01, 0.03 and 0.05.
This scheme performs better than other schemes such as the scheme Pfizer used in <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span>(Figure <a href="#fig:joint_plots">7</a>, lower right and Table <a href="#tbl:benchmark">2</a>).</p>
<div id="tbl:benchmark" class="tablenos">
<table>
<caption><span>Table 2:</span> <strong>Number of fragments in the lower left quadrant in Figure <a href="#fig:joint_plots">7</a> defined as a distance score less than
0.1 and computational cost less than 4000 seconds.</strong> </caption>
<thead>
<tr class="header">
<th>WBO disruption threshold</th>
<th>Number of fragments in optimal fragment quadrant</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.001</td>
<td>182</td>
</tr>
<tr class="even">
<td>0.005</td>
<td>232</td>
</tr>
<tr class="odd">
<td>0.01</td>
<td>268</td>
</tr>
<tr class="even">
<td>0.03</td>
<td>284</td>
</tr>
<tr class="odd">
<td>0.05</td>
<td>243</td>
</tr>
<tr class="even">
<td>0.07</td>
<td>208</td>
</tr>
<tr class="odd">
<td>0.1</td>
<td>209</td>
</tr>
<tr class="even">
<td>Pfizer scheme from <span class="citation" data-cites="XP23v9gZ"><a href="#ref-XP23v9gZ" role="doc-biblioref">31</a></span></td>
<td>197</td>
</tr>
</tbody>
</table>
</div>
<h4 id="benchmark-results-reveal-chemical-groups-that-induce-long-range-effects">3.3.3 Benchmark results reveal chemical groups that induce long range effects</h4>
<div id="fig:difference_hist" class="fignos">
<figure>
<img src="images/combined-score-differences.svg" alt="" /><figcaption><span>Figure 8:</span> <strong>Using the WBO as an indicator of chemical environment disruption improves performance of the fragmentation algorithm.</strong>
Distribution of differences in distance scores for fragments in the validation set (SI Figure <a href="#fig:full_validation_set">16</a>) generated using
Pfizer’s rules and our scheme using 0.03 as the disruption threshold.
For many bonds, both approaches yield equally performing fragments (shown in green).
In some cases, Pfizer’s rules <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span> perform better than our scheme (shown in red); however, the differences are usually very small.
In most cases, using the WBO as an indicator improves the distance score (shown in blue).</figcaption>
</figure>
</div>
<p>In the benchmark experiment (Figure <a href="#fig:joint_plots">7</a>), Omega was used to generate the conformers for which the WBOs were calculated.
Omega aims to generate low energy conformers <span class="citation" data-cites="1G1ccz54w">[<a href="#ref-1G1ccz54w" role="doc-biblioref">46</a>]</span> and in some cases, fragments only have one or two low energy conformers so it is not clear how accurate the distances measured are.
In addition, only comparing low energy conformers do not fully capture torsion energy barriers which we also want to ensure remain accurate relative to their parent’s torsion energy scan.</p>
<p>To mitigate the these issues when validating our scheme, we generated higher energy conformers by driving the torsions and added those WBOs to the distributions.
Furthermore, since we know that WBOs from structures in a QC torsion scan are anti correlated with the QC torsion energy scan <span class="citation" data-cites="kk1Ge7kP">[<a href="#ref-kk1Ge7kP" role="doc-biblioref">33</a>]</span>, adding WBOs from higher energy conformers to the distributions provided a better validation of our method than examining only the distance between WBOs from low energy omega-generated conformers.
The differences in distances of these distributions from fragments generated with our scheme and <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span> is shown in Figure <a href="#fig:difference_hist">8</a>.</p>
<p>For many molecules, using a common sense rule based approach, such as the one used in <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span> to fragmenting molecules, will yield fragments that are the same fragments generated with our scheme shown in green in Figure <a href="#fig:difference_hist">8</a>, and sometimes can even perform slightly better than using the WBO as an indicator (Figure <a href="#fig:difference_hist">8</a>, red).
However, in some cases, especially if certain chemical groups are involved, using the WBO as an indicator significantly improves the electron population overlap about the bonds and brings them closer to their parent’s chemical environment (Figure <a href="#fig:difference_hist">8</a>, blue).
It is important to note that when the fragment generated from both scheme are the same (green in Figure <a href="#fig:difference_hist">8</a>), they are not necessarily the optimal fragment and both schemes can perform equally poorly (SI Figure <a href="#fig:equal-fragments">17</a>, A, B, and C).
However, in most cases both fragments do perform well (SI Figure <a href="#fig:equal-fragments">17</a>, D, E, and F).</p>
<div id="fig:chemical_groups" class="fignos">
<figure>
<img src="images/figure_12.svg" alt="" /><figcaption><span>Figure 9:</span> <strong>Some chemical groups induce non local effects that are captured in fragments when using the WBO as an indicator of chemical environments.</strong>
Wiberg bond order distributions for parent molecules (shown in blue) and fragments generated with Pfizer rules (shown in orange) and our
scheme (shown in green).
The distribution is over all Omega generated conformers and high energy conformers from torsion drives.
The rug plot at the bottom of the distributions are tick marks for each observation.
This figure shows eight chemical groups where the WBO distributions of the highlighted bonds change when those groups are removed.
The ELF10 WBO is shown in the boxes next to the highlighted bonds and the chemical groups are circled in the parent and our fragment.
Better overlap with the blue, parent distribution, indicates a fragment where the chemical environment around the highlighted bond is closer to the parent environment.
In the examples shown here, our scheme generates fragments where the WBO distribution of the bond of interest has better overlap with the parent WBO distribution.
Changes are consistent across the validation set.
Since the parent molecule in <strong>[G]</strong> has several rotatable bonds, there are many tick marks in its rug plot.</figcaption>
</figure>
</div>
<p>Upon closer inspection of the validation set, we found eight chemical groups that induce long range effects to sensitive bonds shown in
Figure <a href="#fig:chemical_groups">9</a>.
These chemical groups with representative examples are shown in Figure <a href="#fig:chemical_groups">9</a>.
The groups are ordered by how strongly they induce long range effect, in decreasing order. The most dramatic change happens when a phosphate group is removed (Figure <a href="#fig:chemical_groups">9</a>, A).
The variance of the WBO distribution increases which conveys an increase in relative energies of conformers in the QC torsion scans.
In other molecules where phosphates are removed, the variance can decrease even if the phosphate group is ten bonds away (Figure <a href="#fig:failure_modes">10</a>, F and SI Figure <a href="#fig:si-phosphate">18</a> E).</p>
<p>In Figure <a href="#fig:chemical_groups">9</a>, B, removing a protonated nitrogen that is double bonded causes the WBO distribution to shift and the variance to increase.
Long range effects are seen in other molecules with similar chemical patterns up to eight bonds away (SI Figure <a href="#fig:si-nitrogen">19</a>, E).
Removing a nitrile group (Figure <a href="#fig:chemical_groups">9</a>, C) and sulfonamide group (Figure <a href="#fig:chemical_groups">9</a>, D) have similar effects on the WBO distributions which is also consistent with other molecules that contain these groups up to three bonds away (SI Figures <a href="#fig:si-nitrile">20</a> and <a href="#fig:si-sulfonamide">21</a>).
A protonated nitrogen and deprotonated oxygen (Figure <a href="#fig:chemical_groups">9</a> E and F) can effects bonds between 3-6 bonds away (SI Figures <a href="#fig:si-nitrogen">19</a> and <a href="#fig:si-oxygen">22</a>).
While the changes in distributions for removing a nitro group and sulfur (Figure <a href="#fig:chemical_groups">9</a>, G and H) are not as big as other chemical groups, they are mostly consistent across other molecules in the validation set (SI Figures <a href="#fig:si-nitro">23</a> and <a href="#fig:si-sulfur">24</a>).</p>
<div id="fig:failure_modes" class="fignos">
<figure>
<img src="images/figure-14.svg" alt="" /><figcaption><span>Figure 10:</span> <strong>Using the WBO as an indicator when fragmenting can still fail to find the optimal fragment.</strong>
Our scheme can fail in several ways.
<strong>[A]</strong> A smaller fragment (shown in orange) is just as good as a larger fragment (shown in green) even if the ELF10 WBO estimate of the bond in the smaller fragment relative to its parent (shown in blue) is more than the disruption threshold.
<strong>[B]</strong> While our scheme finds a fragment with good overlap of the WBO distributions (shown in green), it is not the smallest fragment possible with good distributions overlap (smallest
fragment with good overlap is shown in purple).
<strong>[C]</strong> The fragment we find is bigger than what the simple scheme finds (shown in orange) but without improving the WBO overlap (green). The optimal fragment that neither scheme generates is shown in purple.
<strong>[D]</strong> Our scheme finds a larger fragment that has worse WBO distribution overlap.
<strong>[E]</strong> and <strong>[F]</strong>. Sometimes, almost the entire molecule is needed to achieve good WBO distribution overlap between the fragment and the parent. This is not a failure mode but inherent to the challenge of fragmenting molecules for QC calculations.</figcaption>
</figure>
</div>
<p>While our scheme captures long range effects that a simple rule based approach does not, it is not an optimal solution and will sometimes fail to find the most optimal fragment.
By optimal we mean the smallest fragment that retains the torsion potential of the bond in the parent molecule.
Our scheme can fail in multiple ways as illustrated in Figure <a href="#fig:failure_modes">10</a> and listed below.</p>
<ol type="1">
<li><p>The selected fragment has good WBO distributions overlap but is not the smallest fragment.
This is illustrated in both Figures <a href="#fig:failure_modes">10</a> A and B.
In A, the fragment that Pfizer scheme find is smaller and has a WBO distribution that is close to the parent’s WBO distribution (MMD 0.019).
In this case, the ELF10 WBO estimate of the bond in the fragment is 0.11 lower than the ELF10 WBO estimate in the parent molecule.
In B, our fragment has better WBO distribution overlap with the parent WBO distribution vs using Pfizer’s scheme (0.017 vs 0.212), but it is not the smallest fragment.
According to the fragment highlighted in purple, the benzene ring is not required to achieve good overlap of the WBO distributions (0.051).</p></li>
<li><p>Sometimes, the fragments we find are bigger than Pfizer’s scheme fragment and the remote substituents do not improve the WBO distribution overlap (MMD 0.079 vs 0.071) (Figure <a href="#fig:failure_modes">10</a> C).
The better fragment is shown in purple. It is both smaller and has better overlap (MMD 0.027) than the orange and green fragment.</p></li>
<li><p>Sometimes, the fragment we find is both larger and has worse overlap (Figure <a href="#fig:failure_modes">10</a>, D; 0.054 vs 0.024) than what the Pfizer’s scheme generates.</p></li>
<li><p>While it is usually possible to find a fragment that is significantly smaller than the parent and retains remote substituent effects, the effects are sometimes more than 3-6 bonds away and a large fragment is needed to accurately represent the chemical environment of the parent molecule.
Two such examples are shown in Figure <a href="#fig:failure_modes">10</a> E and F.
In E, not only is the protonated nitrogen needed (shown in green), but the alcohol group is also needed to achieve good WBO distribution overlap (shown in purple).
In F, the phosphate group nine bonds away from the bond of interest is needed to capture the density of of the mode at 1.2 (shown in blue and purple).</p></li>
</ol>
<p>As we have shown, using the WBO as an indicator for fragmentation is a good general approach, albeit not always optimal.
To always find the optimal fragment, all possible fragments would need to be generated and their WBOs calculated.
As discussed in section 2.1, the search space for all possible fragments can become very large which would be too costly to enumerate.
Therefore, we chose to use heuristics discussed in the detailed methods (section 5.2.3) to grow out the fragments when the WBO on the central bond indicates that the chemical environment has been disrupted.</p>
<h4 id="validating-the-fragmentation-scheme">3.3.4 Validating the fragmentation scheme</h4>
<div id="fig:validate_fragmenter" class="fignos">
<figure>
<img src="images/validate-fragmenter.svg" alt="" /><figcaption><span>Figure 11:</span> <strong>Using WBO as a criteria for fragmentation improves the chemical equivalency of the fragment to the substructure in the parent molecule.</strong>
Representative QC torsion profiles of drug molecules (parent molecules shown in blue), fragments generated from rule based scheme (shown in orange) and fragments generated with the WBO scheme (green).
<strong>[A]</strong> Torsion profile about the highlighted bond in Chloroprocaine for the parent molecule (blue), WBO scheme (green) and simple rules (orange).
<strong>[B]</strong> Same as <strong>A</strong> for Phenformin.
<strong>[C]</strong> Same as <strong>A</strong> for Furosemide.
<strong>[D]</strong> Same as <strong>A</strong> for Nitazoxanide. Here, the parent and fragment generated with the WBO scheme are the same.
<strong>[E]</strong> Same as <strong>A</strong> for Cimetidine.
<strong>[F]</strong> Same as <strong>C</strong> for Furosemide.</figcaption>
</figure>
</div>
<p>To validate our fragmentation scheme, we ran several series of torsion scans on parent molecules and fragments - both fragments generated using only the rules used in <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span> and fragments using our WBO based scheme.
For all the molecules we tested, we found that the torsion scans of the fragments using the different schemes differed significantly as shown in Figure <a href="#fig:validate_fragmenter">11</a>
To avoid high computational cost and through-space intramolecular interactions, we chose parent molecules that were less than 21 heavy atoms.
Therefore, some of the fragments found by our WBO scheme were the parent molecules (Figures <a href="#fig:validate_fragmenter">11</a> D and F).
For the cases where the WBO scheme generated fragments that were smaller than the parent molecules, the QC torsion scan of those fragments were closer to the QC torsion scans in the parent molecule than for the fragments generated with simple rules.
The only exception is Figure <a href="#fig:validate_fragmenter">11</a> E where the QC scan of the fragment without the nitrile has a smaller RMSE relative to the parent QC scan as the WBO generated fragment (RMSE 6.38 vs 6.97).
This discrepancy is a result of the asymmetry in the parent’s molecule QC torsion scan (blue scan).
The asymmetry arises from favorable through-space interactions between the nitrile and hydrogens on the methyl on the imidazole at dihedral angles 15<span class="math inline">\(^{\circ}\)</span> - 115<span class="math inline">\(^{\circ}\)</span>.
Such long-range through-space favorable interactions are effects that should be handled by non-bonded force field terms so they should be avoided in the data used to fit torsion parameters to.
Therefore, we view Figure <a href="#fig:validate_fragmenter">11</a> E as a good result.</p>
<h2 id="conclusion">4. Conclusion</h2>
<p>We have shown that the AM1 ELF10 WBO estimate is a simple, yet informative quantity about the extent of binding between two connecting atoms,
thus descriptive of a bond’s chemical environment, its level of conjugation, and resistance to rotation.
We can use the change in WBO of a bond to quantify the amount of disruption of its chemical environment due to remote chemical
substituent changes, specifically for bonds that are sensitive to peripheral chemical changes such as bonds in or adjacent to
conjugated systems, or bonds involving atoms that have lone pairs.</p>
<p>We used this concept to extend a rule-based fragmentation scheme to improve the resulting fragments.
By using the WBO of the central bond as an indicator of its chemical environment disruption, our extension adds remote substituents until the change in WBO is lower than a user defined threshold.
This simple addition improves the quality of the resulting fragments, specifically for bonds in conjugated systems and molecules with remote substituents that have long-range effects.
We generated a validation set using exhaustive fragmentation to benchmark fragmentation schemes and found that a threshold of 0.03 will find the most fragments that minimize both fragment size and distance to the parent’s conformation distribution about the bond.
We also found eight chemical groups that have long-range effects on sensitive bonds and their inclusion is necessary to recapitulate a parent’s chemical environment even if they are 3-6 bonds away from the central bond.</p>
<p>Overall, we believe the approach presented here provides a good general approach to fragment molecules for QC data generation to assist in parametrization of general force fields.
Its approach on our test set seems superior to that of straightforward alternatives.
The method is currently available as an open source Python library <span class="citation" data-cites="CxKjna86">[<a href="#ref-CxKjna86" role="doc-biblioref">50</a>]</span>.
We plan ot apply this approach broadly within the OpenFF Initiative and incorporate this functionality in the open force field toolkit <span class="citation" data-cites="ggfhCq68">[<a href="#ref-ggfhCq68" role="doc-biblioref">51</a>]</span>
In the future, this approach can be made more efficient by using machine learning methods to learn the chemical patterns that should not be fragmented using the dataset shared here.</p>
<h2 id="detailed-methods">5. Detailed methods</h2>
<h4 id="exhaustive-fragmentation-dataset">5.1 Exhaustive fragmentation dataset</h4>
<p>The exhaustive fragmentation dataset was generated by filtering DrugBank version (version 5.1.3 downloaded on 2019-06-06) <span class="citation" data-cites="1FI8iuYiQ">[<a href="#ref-1FI8iuYiQ" role="doc-biblioref">21</a>]</span> with criteria described in section 4 and repeated here for clarity:</p>
<ol type="1">
<li>FDA approved</li>
<li>Ring sized between 3 and 14 heavy atoms</li>
<li>Rotatable bonds between 4 and 10</li>
<li>At least one aromatic ring</li>
<li>Only a single connected component</li>
</ol>
<p>This left us with 730 molecules.
To expand protonation and tautomeric states, we used <code>OEGetReasonableTautomers</code> from QUACPAC (OpenEye ToolKit version 2019.Apr.2) in the
<code>states.py</code> module in <code>fragmenter</code> (version v0.0.2+175.g6fbbf32 for this original set, but versions v0.0.3, v0.0.4 and 0.0.6 will
generate the same results with the same options).
We set <code>pKaNorm</code> to True so that the ionization state of each tautomer is assigned to a predominant state at pH ~ 7.4.
This generated 1289 molecules.
The smi file with all 1289 molecules is located in the manuscript’s <a href="https://github.com/choderalab/fragmenter_data/blob/master/combinatorial_fragmentation/enumerate_states/validation_set.smi">data repository</a></p>
<p>We then used the <code>CombinatorialFragmenter</code> from <code>fragmenter</code> version v0.0.2+179.g0e7e9e3 (versions v0.0.3 and v0.0.4 will generate
the same fragments with the same options) to generate all possible fragments for each molecules.
We set the option <code>functional_groups</code> to False so that all functional groups besides rings will also get fragmented so we can use the data to explore which functional groups
should not be fragmented. We used the default settings for all other options ( <code>min_rotor</code> is 1 and <code>min_heavy_atoms</code> is 4 so that the smallest fragments have at least one torsion.
<code>max_rotors</code> is the number of rotors in the parent molecules so that the largest fragment generated is one less rotor than the parent molecule).
This generated ~300,000 fragments.</p>
<p>We then used Omega (OpenEye version 2019.Apr.2) to generate conformers for each fragment and calculated each conformer’s WBOs as described above.
All scripts used to generate this dataset are in
<a href="https://github.com/choderalab/fragmenter_data/tree/master/combinatorial_fragmentation">github.com/choderalab/fragmenter_data/combinatorial_fragmentation</a>.
The dataset is available on Zenodo <span class="citation" data-cites="H4PaZlG4">[<a href="#ref-H4PaZlG4" role="doc-biblioref">52</a>]</span>.</p>
<p>The benchmark set used to evaluate disruption thresholds and compare to other schemes were chosen as described in Section 3.5.2.
<code>fragmenter</code> version 0.0.6 was used to generate fragments for the different schemes and disruption thresholds.</p>
<h3 id="fragmenting-molecules">5.2 Fragmenting molecules</h3>
<p>The <code>fragmenter</code> package provides several fragmentation schemes with various options. Below we discuss different modes of
fragmentation and their options.</p>
<h4 id="exhaustive-fragmentation-generates-all-possible-fragments-of-a-parent-molecule.">5.2.1 Exhaustive fragmentation generates all possible fragments of a parent molecule.</h4>
<p>This functionality is provided by the <code>CombinatorialFragmenter</code> class in the <code>fragment.py</code> module. To use this class, the user
needs to provide an openeye molecule. <code>fragmenter</code> provides a list of functional groups SMARTS in a yaml file located in <code>fragmenter/data/fgroup_smarts_combs.yml</code>
that it will not fragment by default. This list is given in table <a href="#tbl:fgroups_comb">3</a>. The list is different than the default list used on the <code>WBOFragmenter</code>
because here the carbon bonded to the functional groups are also tagged. To allow all functional groups to be fragmented, the user can set the parameter
<code>functional_groups = False</code>. This option will fragment all bonds besides bond in rings. The user can also provide their own dictionary of
functional group SMARTS patterns that they wish to avoid fragmenting.</p>
<div id="tbl:fgroups_comb" class="tablenos">
<table>
<caption><span>Table 3:</span> <strong>Default functional groups that the <code>CombinatorialFragmenter</code> preserves whole during fragmentation.</strong>
This list is not comprehensive and is
different than the list used for the <code>WBOFragmenter</code> </caption>
<thead>
<tr class="header">
<th>Chemical group</th>
<th>SMARTS pattern</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>amide</td>
<td><code>[NX3R0][CX3](=[OX1])</code></td>
</tr>
<tr class="even">
<td>sulfone</td>
<td><code>[#16X4](=[OX1])=([OX1])</code></td>
</tr>
<tr class="odd">
<td>phosphine_oxide</td>
<td><code>[PX4](=[OX1])([CX4])([CX4])</code></td>
</tr>
<tr class="even">
<td>phosphon</td>
<td><code>[PX4](=[OX1])([OX2])([OX2])</code></td>
</tr>
<tr class="odd">
<td>trimethyl</td>
<td><code>[CX4!H]([CX4H3])([CX4H3])([CX4H3])</code></td>
</tr>
<tr class="even">
<td>tri_halide</td>
<td><code>[#6]((([F,Cl,I,Br])[F,Cl,I,Br])[F,Cl,I,Br])</code></td>
</tr>
<tr class="odd">
<td>carboxylic_acid</td>
<td><code>[CX3](=O)[OX2H1]</code></td>
</tr>
<tr class="even">
<td>ester</td>
<td><code>[CX3](=O)[OX2H0]</code></td>
</tr>
<tr class="odd">
<td>dimethyl</td>
<td><code>[CX4H1]([CX4H3])([CX4H3])</code></td>
</tr>
<tr class="even">
<td>carbonyl</td>
<td><code>[CX3R0]=[OX1]</code></td>
</tr>
<tr class="odd">
<td>alkyne</td>
<td><code>[CX2]#[CX2]</code></td>
</tr>
<tr class="even">
<td>nitrile</td>
<td><code>[NX1]#[CX2]</code></td>
</tr>
</tbody>
</table>
</div>
<p>The user can also set the minimum and maximum number of rotatable bonds, and minimum heavy atoms in a fragment.</p>
<h4 id="generate-minimal-fragments">5.2.2 Generate minimal fragments</h4>
<p>The <code>PfizerFragmenter</code> implements the scheme developed at Pfizer and described in <span class="citation" data-cites="XP23v9gZ">[<a href="#ref-XP23v9gZ" role="doc-biblioref">31</a>]</span>.
It uses the same list
of functional groups as the <code>WBOFragmenter</code> uses.
The user can also provide their own SMARTS patterns of functional groups not to fragment.</p>
<h4 id="using-the-wbo-as-a-surrogate-for-changes-in-chemical-environment.">5.2.3 Using the WBO as a surrogate for changes in chemical environment.</h4>
<p>The <code>WBOFragmenter</code> implements the FBO scheme described in this paper. The functional groups that are not fragmented are given in table <a href="#tbl:fgroups">1</a>.
Users can add more SMARTS patterns if needed.</p>
<p>When the WBO on a central bond in a minimal fragment has been disrupted more than the threshold, remote atoms need to be added
onto the fragment.
However, there are multiple ways to grow out a fragment and enumerating all possible ways to find the best one can become too computationally expensive.
Therefore, we need to use heuristics to decide where to add the next atoms.
The two heuristics available in <code>fragmenter</code> are:</p>
<ol type="1">
<li><p><strong>Shortest path length</strong>
Here, the bond with the shortest path to the central bond is added next.
The rationale for this heuristic is that atoms closer
to the central bond will have a greater influence to the bond’s chemical environment.
If more than one connected bond has the shortest path to the central bond, the bond with the higher WBO is added next.</p></li>
<li><p><strong>Greatest WBO</strong>
Here, the bonds connected to the fragment that have the greatest WBO is added next.
The rationale for this heuristic is that
bonds with higher WBO are more likely to be involved in extended conjugation that can influence the central bond.</p></li>
</ol>
<p>Both of these heuristics will sometimes give different results (Figure <a href="#fig:si-heuristics">25</a>).
We found that for the benchmark set we tested,
the shortest path heuristic preformed slightly better, or found more optimal fragments when compared to using the greatest WBO heuristic (284 vs 262 in the optimal quadrant).
Figure <a href="#fig:si-heuristics">25</a> compares the scores and sizes of fragments generated with different growth paths. The shortest path length
heuristic generates smaller fragments (Figure <a href="#fig:si-heuristics">25</a> <strong>A</strong>)</p>
<h4 id="fragmenter-validation-dataset">5.2 Fragmenter validation dataset</h4>
<p>The torsion scans shown in Figure <a href="#fig:validate_fragmenter">11</a> were run on QCArchive <span class="citation" data-cites="v6Tvjyp5">[<a href="#ref-v6Tvjyp5" role="doc-biblioref">18</a>]</span>.
They were computed with TorsionDrive <span class="citation" data-cites="Kad6jO9v">[<a href="#ref-Kad6jO9v" role="doc-biblioref">20</a>]</span> and geomeTRIC <span class="citation" data-cites="zyjNwQ0g">[<a href="#ref-zyjNwQ0g" role="doc-biblioref">53</a>]</span>,
as standalone geometry optimizer interfaced with the QCEngine <span class="citation" data-cites="Hu5LsEaN">[<a href="#ref-Hu5LsEaN" role="doc-biblioref">54</a>]</span> project.
The gradients were computed at the B3LYP-D3(BJ)/DZVP level of theory <span class="citation" data-cites="17YEERBX3 flKRoCNc CqesmIsy">[<a href="#ref-17YEERBX3" role="doc-biblioref">15</a>,<a href="#ref-flKRoCNc" role="doc-biblioref">55</a>,<a href="#ref-CqesmIsy" role="doc-biblioref">56</a>]</span> with Psi4 <span class="citation" data-cites="14Lb3OazM">[<a href="#ref-14Lb3OazM" role="doc-biblioref">57</a>]</span>.
The torsion scans are available on QCArchive <span class="citation" data-cites="qXilVj0B">[<a href="#ref-qXilVj0B" role="doc-biblioref">17</a>]</span> as a <code>TorsionDriveDataset</code> named <code>OpenFF Fragmenter Validation 1.0</code>.</p>
<h2 id="code-and-data">Code and data</h2>
<ul>
<li><a href="https://github.com/openforcefield/fragmenter">GitHub repository</a> fragmenter code.</li>
<li><a href="https://github.com/choderalab/fragmenter_data">GitHub repository</a> Data generation, analysis scripts and generating plots for the manuscript.</li>
<li><a href="https://github.com/openforcefield/qca-dataset-submission">GitHub repository</a> QCArchive dataset submission scripts.</li>
</ul>
<h2 id="author-contributions">Author contributions</h2>
<p>Conceptualization: CDS, CIB, JDC;
Methodology: CDS, DGAS;
Software: CDS, DGAS, LPW;
Formal Analysis: CDS;
Investigation: CDS;
Resources: JDC;
Data Curation: CDS, DGAS;
Writing-Original draft: CDS;
Writing-Review and editing: CDS, CIB, DGAS, JF, DLM, JDC;
Visualization: CDS;
Supervision: JDC, CIB, DLM, LPW;
Project Administration: JDC;
Funding Acquisition: CDS, JDC;</p>
<h2 id="acknowledgments">Acknowledgments</h2>
<p>CDS was supported by a fellowship from The Molecular Sciences Software Institute under NSF grant ACI-1547580 and an NSF GRFP Fellowship under grant DGE-1257284.
DGAS was supported by NSF grant OAC-1547580 and the Open Force Field Consortium.
CDS, JF and JDC were supported by NSF grant CHE-1738979.
DLM and JDC were supported by NIH grant R01GM132386.
JDC acknowledges support from NIH grant P30CA008748, NIH grant GM121505, and the Sloan Kettering Institute.
DLM acknowledges support from NIH grant R01GM124270
We acknowledge Mehtap Isik, Andrea Rizzi, Gregory Ross, Bas Rustenberg, Patrick Grinaway, Melissa Boby, and other members of the Chodera lab for helpful discussions.
We acknowledge Open Force Field Consortium members, specifically the scientists at Pfizer, Xinjun Hou, Brajesh Rai, and Qingyi Yang, and Caitlin Bannan, Alberta Gobbi, and Adrian Roitberg for helpful discussions.
We acknowledge David Dotson for help in generating the fragmenter validation QC torsion scans.</p>
<h2 id="disclosures">Disclosures</h2>
<p>JDC was a member of the Scientific Advisory Board for Schr"{o}dinger, LLC during part of this study.
JDC and DLM is a current member of the Scientific Advisory Board of OpenEye Scientific Software.
DLM is an Open Science Fellow with Silicon Therapeutics.
The Chodera laboratory receives or has received funding from multiple sources, including the National Institutes of Health, the National Science Foundation, the Parker Institute for Cancer Immunotherapy, Relay Therapeutics, Entasis Therapeutics, Silicon Therapeutics, EMD Serono (Merck KGaA), AstraZeneca, Vir Biotechnology, Bayer, XtalPi, the Molecular Sciences Software Institute, the Starr Cancer Consortium, the Open Force Field Consortium, Cycle for Survival, a Louis V. Gerstner Young Investigator Award, and the Sloan Kettering Institute.
A complete funding history for the Chodera lab can be found at http://choderalab.org/funding.</p>
<h2 class="page_break_before" id="references">References</h2>
<!-- Explicitly insert bibliography here -->
<div id="refs" class="references hanging-indent" role="doc-bibliography">
<div id="ref-mbmV3Fg8">
<p>1. <strong>Toward Learned Chemical Perception of Force Field Typing Rules</strong><br />
Camila Zanette, Caitlin C. Bannan, Christopher I. Bayly, Josh Fass, Michael K. Gilson, Michael R. Shirts, John D. Chodera, David L. Mobley<br />
<em>Journal of Chemical Theory and Computation</em> (2018-12-04) <a href="https://doi.org/gft4hf">https://doi.org/gft4hf</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jctc.8b00821">10.1021/acs.jctc.8b00821</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/30512951">30512951</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6467725">PMC6467725</a></p>
</div>
<div id="ref-18mvPmwwB">
<p>2. <strong>OPLS3: A Force Field Providing Broad Coverage of Drug-like Small Molecules and Proteins</strong><br />
Edward Harder, Wolfgang Damm, Jon Maple, Chuanjie Wu, Mark Reboul, Jin Yu Xiang, Lingle Wang, Dmitry Lupyan, Markus K. Dahlgren, Jennifer L. Knight, … Richard A. Friesner<br />
<em>Journal of Chemical Theory and Computation</em> (2015-12) <a href="https://doi.org/f76wpm">https://doi.org/f76wpm</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jctc.5b00864">10.1021/acs.jctc.5b00864</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/26584231">26584231</a></p>
</div>
<div id="ref-13fQUQyf9">
<p>3. <strong>Accuracy evaluation and addition of improved dihedral parameters for the MMFF94s</strong><br />
Joel Wahl, Joel Freyss, Modest von Korff, Thomas Sander<br />
<em>Journal of Cheminformatics</em> (2019-08-07) <a href="https://doi.org/gf6rz2">https://doi.org/gf6rz2</a><br />
DOI: <a href="https://doi.org/10.1186/s13321-019-0371-6">10.1186/s13321-019-0371-6</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/31392432">31392432</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6686419">PMC6686419</a></p>
</div>
<div id="ref-Io39j4ig">
<p>4. <strong>Paramfit: Automated optimization of force field parameters for molecular dynamics simulations</strong><br />
Robin M. Betz, Ross C. Walker<br />
<em>Journal of Computational Chemistry</em> (2015-01-15) <a href="https://doi.org/f6svdh">https://doi.org/f6svdh</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.23775">10.1002/jcc.23775</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/25413259">25413259</a></p>
</div>
<div id="ref-5cjbQnbG">
<p>5. <strong>Rapid parameterization of small molecules using the force field toolkit</strong><br />
Christopher G. Mayne, Jan Saam, Klaus Schulten, Emad Tajkhorshid, James C. Gumbart<br />
<em>Journal of Computational Chemistry</em> (2013-12-15) <a href="https://doi.org/f5ggrj">https://doi.org/f5ggrj</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.23422">10.1002/jcc.23422</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/24000174">24000174</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3874408">PMC3874408</a></p>
</div>
<div id="ref-CstjV2w8">
<p>6. <strong>Fitting of Dihedral Terms in Classical Force Fields as an Analytic Linear Least-Squares Problem</strong><br />
Chad W. Hopkins, Adrian E. Roitberg<br />
<em>Journal of Chemical Information and Modeling</em> (2014-07-09) <a href="https://doi.org/f6cffs">https://doi.org/f6cffs</a><br />
DOI: <a href="https://doi.org/10.1021/ci500112w">10.1021/ci500112w</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/24960267">24960267</a></p>
</div>
<div id="ref-1GDaakPWY">
<p>7. <strong>A Second Generation Force Field for the Simulation of Proteins, Nucleic Acids, and Organic Molecules</strong><br />
Wendy D. Cornell, Piotr Cieplak, Christopher I. Bayly, Ian R. Gould, Kenneth M. Merz, David M. Ferguson, David C. Spellmeyer, Thomas Fox, James W. Caldwell, Peter A. Kollman<br />
<em>Journal of the American Chemical Society</em> (1995-05) <a href="https://doi.org/dbzh27">https://doi.org/dbzh27</a><br />
DOI: <a href="https://doi.org/10.1021/ja00124a002">10.1021/ja00124a002</a></p>
</div>
<div id="ref-11Z8pXbEW">
<p>8. <strong>CHARMM: A program for macromolecular energy, minimization, and dynamics calculations</strong><br />
Bernard R. Brooks, Robert E. Bruccoleri, Barry D. Olafson, David J. States, S. Swaminathan, Martin Karplus<br />
<em>Journal of Computational Chemistry</em> (1983-Summer) <a href="https://doi.org/bqh7f2">https://doi.org/bqh7f2</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.540040211">10.1002/jcc.540040211</a></p>
</div>
<div id="ref-Mi3Ujd07">
<p>9. <strong>Development and Testing of the OPLS All-Atom Force Field on Conformational Energetics and Properties of Organic Liquids</strong><br />
William L. Jorgensen, David S. Maxwell, Julian Tirado-Rives<br />
<em>Journal of the American Chemical Society</em> (1996-01) <a href="https://doi.org/fvftxj">https://doi.org/fvftxj</a><br />
DOI: <a href="https://doi.org/10.1021/ja9621760">10.1021/ja9621760</a></p>
</div>
<div id="ref-i8ZZOoVS">
<p>10. <strong>Automated conformational energy fitting for force-field development</strong><br />
Olgun Guvench, Alexander D. MacKerell<br />
<em>Journal of Molecular Modeling</em> (2008-05-06) <a href="https://doi.org/bzphqw">https://doi.org/bzphqw</a><br />
DOI: <a href="https://doi.org/10.1007/s00894-008-0305-0">10.1007/s00894-008-0305-0</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/18458967">18458967</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2864003">PMC2864003</a></p>
</div>
<div id="ref-SgTYwIda">
<p>11. <strong>Machine learning of correlated dihedral potentials for atomistic molecular force fields</strong><br />
Pascal Friederich, Manuel Konrad, Timo Strunk, Wolfgang Wenzel<br />
<em>Scientific Reports</em> (2018-02-07) <a href="https://doi.org/gczmpn">https://doi.org/gczmpn</a><br />
DOI: <a href="https://doi.org/10.1038/s41598-018-21070-0">10.1038/s41598-018-21070-0</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/29416116">29416116</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5803249">PMC5803249</a></p>
</div>
<div id="ref-3fVo3EjD">
<p>12. <strong>Empirical force fields for biological macromolecules: Overview and issues</strong><br />
Alexander D. Mackerell<br />
<em>Journal of Computational Chemistry</em> (2004-10) <a href="https://doi.org/dbhsbb">https://doi.org/dbhsbb</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.20082">10.1002/jcc.20082</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/15264253">15264253</a></p>
</div>
<div id="ref-U4kYckJ1">
<p>13. <strong>ff19SB: Amino-Acid Specific Protein Backbone Parameters Trained Against Quantum Mechanics Energy Surfaces in Solution</strong><br />
Chuan Tian, Koushik Kasavajhala, Kellon Belfon, Lauren Raguette, He Huang, Angela Migues, John Bickel, Yuzhang Wang, Jorge Pincay, Qin Wu, Carlos Simmerling<br />
(2019-06-17) <a href="https://doi.org/gf6rz8">https://doi.org/gf6rz8</a><br />
DOI: <a href="https://doi.org/10.26434/chemrxiv.8279681">10.26434/chemrxiv.8279681</a></p>
</div>
<div id="ref-YPDz9hB3">
<p>14. <strong>A consistent and accurate <em>ab initio</em> parametrization of density functional dispersion correction (DFT-D) for the 94 elements H-Pu</strong><br />
Stefan Grimme, Jens Antony, Stephan Ehrlich, Helge Krieg<br />
<em>The Journal of Chemical Physics</em> (2010-04-21) <a href="https://doi.org/bnt82x">https://doi.org/bnt82x</a><br />
DOI: <a href="https://doi.org/10.1063/1.3382344">10.1063/1.3382344</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/20423165">20423165</a></p>
</div>
<div id="ref-17YEERBX3">
<p>15. <strong>Optimization of Gaussian-type basis sets for local spin density functional calculations. Part I. Boron through neon, optimization technique and validation</strong><br />
Nathalie Godbout, Dennis R. Salahub, Jan Andzelm, Erich Wimmer<br />
<em>Canadian Journal of Chemistry</em> (1992-02-01) <a href="https://doi.org/c78qjn">https://doi.org/c78qjn</a><br />
DOI: <a href="https://doi.org/10.1139/v92-079">10.1139/v92-079</a></p>
</div>
<div id="ref-I9yhXyTJ">
<p>16. <strong>A quantitative study of the scaling properties of the Hartree–Fock method</strong><br />
Douglas L. Strout, Gustavo E. Scuseria<br />
<em>The Journal of Chemical Physics</em> (1995-06) <a href="https://doi.org/b3323h">https://doi.org/b3323h</a><br />
DOI: <a href="https://doi.org/10.1063/1.468836">10.1063/1.468836</a></p>
</div>
<div id="ref-qXilVj0B">
<p>17. <strong>The MolSSI QCArchive</strong><a href="https://qcarchive.molssi.org/">https://qcarchive.molssi.org/</a></p>
</div>
<div id="ref-v6Tvjyp5">
<p>18. <strong>The QCA project: An open‐source platform to compute, organize, and share quantum chemistry data</strong><br />
Daniel G. A. Smith, Doaa Altarawy, Lori A. Burns, Matthew Welborn, Levi N. Naden, Logan Ward, Sam Ellis, Benjamin P. Pritchard, T. Daniel Crawford<br />
<em>WIREs Computational Molecular Science</em> (2020-07-31) <a href="https://doi.org/gg8w5b">https://doi.org/gg8w5b</a><br />
DOI: <a href="https://doi.org/10.1002/wcms.1491">10.1002/wcms.1491</a></p>
</div>
<div id="ref-1E3wArY0j">
<p>19. <strong>Building a More Predictive Protein Force Field: A Systematic and Reproducible Route to AMBER-FB15</strong><br />
Lee-Ping Wang, Keri A. McKiernan, Joseph Gomes, Kyle A. Beauchamp, Teresa Head-Gordon, Julia E. Rice, William C. Swope, Todd J. Martínez, Vijay S. Pande<br />
<em>The Journal of Physical Chemistry B</em> (2017-04-06) <a href="https://doi.org/f92nv5">https://doi.org/f92nv5</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jpcb.7b02320">10.1021/acs.jpcb.7b02320</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/28306259">28306259</a></p>
</div>
<div id="ref-Kad6jO9v">
<p>20. <strong>Driving Torsion Scans with Wavefront Propagation</strong><br />
Yudong Qiu, Daniel Smith, Chaya Stern, mudong feng, Lee-Ping Wang<br />
(2020-04-01) <a href="https://doi.org/ggt8ch">https://doi.org/ggt8ch</a><br />
DOI: <a href="https://doi.org/10.26434/chemrxiv.12044673.v1">10.26434/chemrxiv.12044673.v1</a></p>
</div>
<div id="ref-1FI8iuYiQ">
<p>21. <strong>DrugBank 5.0: a major update to the DrugBank database for 2018</strong><br />
David S Wishart, Yannick D Feunang, An C Guo, Elvis J Lo, Ana Marcu, Jason R Grant, Tanvir Sajed, Daniel Johnson, Carin Li, Zinat Sayeeda, … Michael Wilson<br />
<em>Nucleic Acids Research</em> (2018-01-04) <a href="https://doi.org/gcwtzk">https://doi.org/gcwtzk</a><br />
DOI: <a href="https://doi.org/10.1093/nar/gkx1037">10.1093/nar/gkx1037</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/29126136">29126136</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5753335">PMC5753335</a></p>
</div>
<div id="ref-xbUA1nkO">
<p>22. <strong>RECAPRetrosynthetic Combinatorial Analysis Procedure: A Powerful New Technique for Identifying Privileged Molecular Fragments with Useful Applications in Combinatorial Chemistry</strong><br />
Xiao Qing Lewell, Duncan B. Judd, Stephen P. Watson, Michael M. Hann<br />
<em>Journal of Chemical Information and Computer Sciences</em> (1998-04-11) <a href="https://doi.org/d4z4pf">https://doi.org/d4z4pf</a><br />
DOI: <a href="https://doi.org/10.1021/ci970429i">10.1021/ci970429i</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/9611787">9611787</a></p>
</div>
<div id="ref-15j2SwU5A">
<p>23. <strong>Break Down in Order To Build Up: Decomposing Small Molecules for Fragment-Based Drug Design with <em>e</em> MolFrag</strong><br />
Tairan Liu, Misagh Naderi, Chris Alvin, Supratik Mukhopadhyay, Michal Brylinski<br />
<em>Journal of Chemical Information and Modeling</em> (2017-04-04) <a href="https://doi.org/f9x9bg">https://doi.org/f9x9bg</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jcim.6b00596">10.1021/acs.jcim.6b00596</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/28346786">28346786</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5433162">PMC5433162</a></p>
</div>
<div id="ref-1BZlse7qR">
<p>24. <strong>The Properties of Known Drugs. 1. Molecular Frameworks</strong><br />
Guy W. Bemis, Mark A. Murcko<br />
<em>Journal of Medicinal Chemistry</em> (1996-01) <a href="https://doi.org/fshj3p">https://doi.org/fshj3p</a><br />
DOI: <a href="https://doi.org/10.1021/jm9602928">10.1021/jm9602928</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/8709122">8709122</a></p>
</div>
<div id="ref-vm6HUPt4">
<p>25. <strong>pyEFP: Automatic decomposition of the complex molecular systems into rigid polarizable fragments</strong><br />
Alexey V. Odinokov, Nikita O. Dubinets, Alexander A. Bagaturyants<br />
<em>Journal of Computational Chemistry</em> (2018-05-15) <a href="https://doi.org/gcq4qs">https://doi.org/gcq4qs</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.25149">10.1002/jcc.25149</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/29280158">29280158</a></p>
</div>
<div id="ref-ll3I4A87">
<p>26. <strong>Approximate <em>ab initio</em> energies by systematic molecular fragmentation</strong><br />
Vitali Deev, Michael A. Collins<br />
<em>The Journal of Chemical Physics</em> (2005-04-15) <a href="https://doi.org/ch4zhg">https://doi.org/ch4zhg</a><br />
DOI: <a href="https://doi.org/10.1063/1.1879792">10.1063/1.1879792</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/15945620">15945620</a></p>
</div>
<div id="ref-nRywz8At">
<p>27. <strong>Fragmentation Methods: A Route to Accurate Calculations on Large Systems</strong><br />
Mark S. Gordon, Dmitri G. Fedorov, Spencer R. Pruitt, Lyudmila V. Slipchenko<br />
<em>Chemical Reviews</em> (2011-08-26) <a href="https://doi.org/b8tc8n">https://doi.org/b8tc8n</a><br />
DOI: <a href="https://doi.org/10.1021/cr200093j">10.1021/cr200093j</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/21866983">21866983</a></p>
</div>
<div id="ref-EOlFsQFX">
<p>28. <strong>Systematic fragmentation of large molecules by annihilation</strong><br />
Michael A. Collins<br />
<em>Physical Chemistry Chemical Physics</em> (2012) <a href="https://doi.org/gf6v2d">https://doi.org/gf6v2d</a><br />
DOI: <a href="https://doi.org/10.1039/c2cp23832b">10.1039/c2cp23832b</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/22373545">22373545</a></p>
</div>
<div id="ref-F0de6fPE">
<p>29. <strong>Linear‐scaling semiempirical quantum calculations for macromolecules</strong><br />
Tai‐Sung Lee, Darrin M. York, Weitao Yang<br />
<em>The Journal of Chemical Physics</em> (1996-08-15) <a href="https://doi.org/bdtpqw">https://doi.org/bdtpqw</a><br />
DOI: <a href="https://doi.org/10.1063/1.472136">10.1063/1.472136</a></p>
</div>
<div id="ref-EnOwBZmA">
<p>30. <strong>Flexible effective fragment QM/MM method: Validation through the challenging tests</strong><br />
A. V. Nemukhin, B. L. Grigorenko, I. A. Topol, S. K. Burt<br />
<em>Journal of Computational Chemistry</em> (2003-09) <a href="https://doi.org/dpwk5b">https://doi.org/dpwk5b</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.10309">10.1002/jcc.10309</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/12868106">12868106</a></p>
</div>
<div id="ref-XP23v9gZ">
<p>31. <strong>Comprehensive Assessment of Torsional Strain in Crystal Structures of Small Molecules and Protein–Ligand Complexes using ab Initio Calculations</strong><br />
Brajesh K. Rai, Vishnu Sresht, Qingyi Yang, Ray Unwalla, Meihua Tu, Alan M. Mathiowetz, Gregory A. Bakken<br />
<em>Journal of Chemical Information and Modeling</em> (2019-10) <a href="https://doi.org/ggfxzc">https://doi.org/ggfxzc</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jcim.9b00373">10.1021/acs.jcim.9b00373</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/31573196">31573196</a></p>
</div>
<div id="ref-BES2Ksiq">
<p>32. <strong>Application of the pople-santry-segal CNDO method to the cyclopropylcarbinyl and cyclobutyl cation and to bicyclobutane</strong><br />
K. B. Wiberg<br />
<em>Tetrahedron</em> (1968-01) <a href="https://doi.org/fvwkkh">https://doi.org/fvwkkh</a><br />
DOI: <a href="https://doi.org/10.1016/0040-4020(68)88057-3">10.1016/0040-4020(68)88057-3</a></p>
</div>
<div id="ref-kk1Ge7kP">
<p>33. <strong>Fragmenting molecules for QC torsion drives</strong><br />
Chaya Stern<br />
<em>Zenodo</em> (2019-06-04) <a href="https://doi.org/gg6mq9">https://doi.org/gg6mq9</a><br />
DOI: <a href="https://doi.org/10.5281/zenodo.3238643">10.5281/zenodo.3238643</a></p>
</div>
<div id="ref-hHhjgmIm">
<p>34. <strong>Bond Order Analysis Based on the Laplacian of Electron Density in Fuzzy Overlap Space</strong><br />
Tian Lu, Feiwu Chen<br />
<em>The Journal of Physical Chemistry A</em> (2013-04-02) <a href="https://doi.org/f4t9v3">https://doi.org/f4t9v3</a><br />
DOI: <a href="https://doi.org/10.1021/jp4010345">10.1021/jp4010345</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/23514314">23514314</a></p>
</div>
<div id="ref-14qKIxxbD">
<p>35. <strong>Resonance interactions in acyclic systems</strong><br />
K. B. Wiberg, C. M. Breneman, K. E. Laidig, R. E. Rosenberg<br />
<em>Pure and Applied Chemistry</em> (1989-01-01) <a href="https://doi.org/c6rd43">https://doi.org/c6rd43</a><br />
DOI: <a href="https://doi.org/10.1351/pac198961040635">10.1351/pac198961040635</a></p>
</div>
<div id="ref-cAeBUxqm">
<p>36. <strong>Predicting Trigger Bonds in Explosive Materials through Wiberg Bond Index Analysis</strong><br />
Lenora K. Harper, Ashley L. Shoaf, Craig A. Bayse<br />
<em>ChemPhysChem</em> (2015-12) <a href="https://doi.org/f3jt5h">https://doi.org/f3jt5h</a><br />
DOI: <a href="https://doi.org/10.1002/cphc.201500773">10.1002/cphc.201500773</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/26458868">26458868</a></p>
</div>
<div id="ref-fpE0Y69s">
<p>37. <strong>Torsional Energy Barriers of Biaryls Could Be Predicted by Electron Richness/Deficiency of Aromatic Rings; Advancement of Molecular Mechanics toward Atom-Type Independence</strong><br />
Wanlei Wei, Candide Champion, Zhaomin Liu, Stephen J. Barigye, Paul Labute, Nicolas Moitessier<br />
<em>Journal of Chemical Information and Modeling</em> (2019-08-20) <a href="https://doi.org/ggh677">https://doi.org/ggh677</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jcim.9b00585">10.1021/acs.jcim.9b00585</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/31430147">31430147</a></p>
</div>
<div id="ref-AWj8hnbG">
<p>38. <strong>Atom Types Independent Molecular Mechanics Method for Predicting the Conformational Energy of Small Molecules</strong><br />
Zhaomin Liu, Stephen J. Barigye, Moeed Shahamat, Paul Labute, Nicolas Moitessier<br />
<em>Journal of Chemical Information and Modeling</em> (2018-01-05) <a href="https://doi.org/gcxm7s">https://doi.org/gcxm7s</a><br />
DOI: <a href="https://doi.org/10.1021/acs.jcim.7b00645">10.1021/acs.jcim.7b00645</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/29253333">29253333</a></p>
</div>
<div id="ref-Vx7ALVw2">
<p>39. <strong>Hyperconjugation not steric repulsion leads to the staggered structure of ethane</strong><br />
Vojislava Pophristic, Lionel Goodman<br />
<em>Nature</em> (2001-05) <a href="https://doi.org/dff6j7">https://doi.org/dff6j7</a><br />
DOI: <a href="https://doi.org/10.1038/35079036">10.1038/35079036</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/11385566">11385566</a></p>
</div>
<div id="ref-1DVkKVgPL">
<p>40. <strong>Gauche Effect in 1,2-Difluoroethane. Hyperconjugation, Bent Bonds, Steric Repulsion</strong><br />
Lionel Goodman, Hongbing Gu, Vojislava Pophristic<br />
<em>The Journal of Physical Chemistry A</em> (2005-02) <a href="https://doi.org/dtg782">https://doi.org/dtg782</a><br />
DOI: <a href="https://doi.org/10.1021/jp046290d">10.1021/jp046290d</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/16833433">16833433</a></p>
</div>
<div id="ref-brHoyaiC">
<p>41. <strong>Zur Kenntniss der ungesättigten Verbindungen. Theorie der ungesättigten und aromatischen Verbindungen</strong><br />
Johannes Thiele<br />
<em>Justus Liebig’s Annalen der Chemie</em> (1899) <a href="https://doi.org/fs6s77">https://doi.org/fs6s77</a><br />
DOI: <a href="https://doi.org/10.1002/jlac.18993060107">10.1002/jlac.18993060107</a></p>
</div>
<div id="ref-10vgXCYFf">
<p>42. <strong>IUPAC - conjugated system (C01267)</strong><a href="https://goldbook.iupac.org/terms/view/C01267">https://goldbook.iupac.org/terms/view/C01267</a></p>
</div>
<div id="ref-l3TAWQJ6">
<p>43. <strong>Hyperconjugation <sup>*</sup></strong><br />
Robert S. Mulliken, Carol A. Rieke, Weldon G. Brown<br />
<em>Journal of the American Chemical Society</em> (1941-01) <a href="https://doi.org/brj5s3">https://doi.org/brj5s3</a><br />
DOI: <a href="https://doi.org/10.1021/ja01846a008">10.1021/ja01846a008</a></p>
</div>
<div id="ref-r3xLNmRT">
<p>44. <strong>Can we treat ab initio atomic charges and bond orders as conformation-independent electronic structure descriptors?</strong><br />
T. Yu. Nikolaienko, L. A. Bulavin, D. M. Hovorun<br />
<em>RSC Advances</em> (2016) <a href="https://doi.org/gf66tp">https://doi.org/gf66tp</a><br />
DOI: <a href="https://doi.org/10.1039/c6ra17055b">10.1039/c6ra17055b</a></p>
</div>
<div id="ref-16hZpgNca">
<p>45. <strong>QUACPAC 2.1.0.4 — Applications, v2020.0.4</strong><a href="https://docs.eyesopen.com/applications/quacpac/index.html">https://docs.eyesopen.com/applications/quacpac/index.html</a></p>
</div>
<div id="ref-1G1ccz54w">
<p>46. <strong>Conformer Generation with OMEGA: Algorithm and Validation Using High Quality Structures from the Protein Databank and Cambridge Structural Database</strong><br />
Paul C. D. Hawkins, A. Geoffrey Skillman, Gregory L. Warren, Benjamin A. Ellingson, Matthew T. Stahl<br />
<em>Journal of Chemical Information and Modeling</em> (2010-03-17) <a href="https://doi.org/d4rb6g">https://doi.org/d4rb6g</a><br />
DOI: <a href="https://doi.org/10.1021/ci100031x">10.1021/ci100031x</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/20235588">20235588</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2859685">PMC2859685</a></p>
</div>
<div id="ref-jdbxzMM3">
<p>47. <strong>Conformer Generation with OMEGA: Learning from the Data Set and the Analysis of Failures</strong><br />
Paul C. D. Hawkins, Anthony Nicholls<br />
<em>Journal of Chemical Information and Modeling</em> (2012-11-12) <a href="https://doi.org/f4fdz8">https://doi.org/f4fdz8</a><br />
DOI: <a href="https://doi.org/10.1021/ci300314k">10.1021/ci300314k</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/23082786">23082786</a></p>
</div>
<div id="ref-rvZRlbML">
<p>48. <strong>A Kernel Two-Sample Test</strong><br />
Arthur Gretton, Karsten M. Borgwardt, Malte J. Rasch, Bernhard Schölkopf, Alexander Smola<br />
<em>Journal of Machine Learning Research</em> (2012) <a href="http://jmlr.org/papers/v13/gretton12a.html">http://jmlr.org/papers/v13/gretton12a.html</a></p>
</div>
<div id="ref-8Fq6BXg5">
<p>49. <strong>Survey of multi-objective optimization methods for engineering</strong><br />
R. T. Marler, J. S. Arora<br />
<em>Structural and Multidisciplinary Optimization</em> (2004-04-01) <a href="https://doi.org/dnw6tn">https://doi.org/dnw6tn</a><br />
DOI: <a href="https://doi.org/10.1007/s00158-003-0368-6">10.1007/s00158-003-0368-6</a></p>
</div>
<div id="ref-CxKjna86">
<p>50. <strong>openforcefield/fragmenter</strong><br />
Open Force Field Initiative<br />
(2020-08-16) <a href="https://github.com/openforcefield/fragmenter">https://github.com/openforcefield/fragmenter</a></p>
</div>
<div id="ref-ggfhCq68">
<p>51. <strong>openforcefield/openforcefield</strong><br />
Open Force Field Initiative<br />
(2020-08-21) <a href="https://github.com/openforcefield/openforcefield">https://github.com/openforcefield/openforcefield</a></p>
</div>
<div id="ref-H4PaZlG4">
<p>52. <strong>Dataset associated with the manuscript titled “Capturing non-local through-bond effects when fragmenting molecules for quantum chemical torsion scans”</strong><br />
Chaya D. Stern, Christopher I. Bayly, Daniel G. A. Smith, Josh Fass, Lee-Ping Wang, David L. Mobley, John D. Chodera<br />
<em>Zenodo</em> (2020-08-17) <a href="https://doi.org/gg8w5d">https://doi.org/gg8w5d</a><br />
DOI: <a href="https://doi.org/10.5281/zenodo.3987763">10.5281/zenodo.3987763</a></p>
</div>
<div id="ref-zyjNwQ0g">
<p>53. <strong>leeping/geomeTRIC</strong><br />
Lee-Ping<br />
(2020-08-20) <a href="https://github.com/leeping/geomeTRIC">https://github.com/leeping/geomeTRIC</a></p>
</div>
<div id="ref-Hu5LsEaN">
<p>54. <strong>MolSSI/QCEngine</strong><br />
The Molecular Science Software Institute<br />
(2020-08-19) <a href="https://github.com/MolSSI/QCEngine">https://github.com/MolSSI/QCEngine</a></p>
</div>
<div id="ref-flKRoCNc">
<p>55. <strong>Density‐functional thermochemistry. III. The role of exact exchange</strong><br />
Axel D. Becke<br />
<em>The Journal of Chemical Physics</em> (1993-04) <a href="https://doi.org/d2fq9j">https://doi.org/d2fq9j</a><br />
DOI: <a href="https://doi.org/10.1063/1.464913">10.1063/1.464913</a></p>
</div>
<div id="ref-CqesmIsy">
<p>56. <strong>Effect of the damping function in dispersion corrected density functional theory</strong><br />
Stefan Grimme, Stephan Ehrlich, Lars Goerigk<br />
<em>Journal of Computational Chemistry</em> (2011-05) <a href="https://doi.org/b3ztst">https://doi.org/b3ztst</a><br />
DOI: <a href="https://doi.org/10.1002/jcc.21759">10.1002/jcc.21759</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/21370243">21370243</a></p>
</div>
<div id="ref-14Lb3OazM">
<p>57. <strong>P 1.4: Open-source software for high-throughput quantum chemistry</strong><br />
Daniel G. A. Smith, Lori A. Burns, Andrew C. Simmonett, Robert M. Parrish, Matthew C. Schieber, Raimondas Galvelis, Peter Kraus, Holger Kruse, Roberto Di Remigio, Asem Alenaizan, … C. David Sherrill<br />
<em>The Journal of Chemical Physics</em> (2020-05-14) <a href="https://doi.org/gg8w5c">https://doi.org/gg8w5c</a><br />
DOI: <a href="https://doi.org/10.1063/5.0006002">10.1063/5.0006002</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/32414239">32414239</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7228781">PMC7228781</a></p>
</div>
</div>
<h2 class="page_break_before" id="SI">Supporting Information</h2>
<div id="fig:intel_scaling" class="fignos">
<figure>
<img src="images/SI_Intel_scaling_4.svg" alt="" /><figcaption><span>Figure 12:</span> <strong>QC gradient evaluations scale similarly on various processor</strong>
CPU time (wall time * nthreads) for one gradient evaluation vs. heavy atoms in molecules. All CPUS shown in this figure
are Intel(R) Xeon(R)</figcaption>
</figure>
</div>
<div id="fig:amd_scaling" class="fignos">
<figure>
<img src="images/SI_AMD_scaling_3.svg" alt="" /><figcaption><span>Figure 13:</span> <strong>QC gradient evaluations scale similarly on various processor</strong>
Same as Figure <a href="#fig:intel_scaling">12</a> but on AMD processors</figcaption>
</figure>
</div>
<div id="fig:grads_per_opt" class="fignos">
<figure>
<img src="images/gradients_per_opts_2.svg" alt="" /><figcaption><span>Figure 14:</span> <strong>Distributions of number of gradient evaluations per optimizations for different size molecules</strong>
The number of gradient evaluations per optimization depends on many factors such as initialization and tolerance, but there
is also a slight dependency on molecular size as shown in this figure</figcaption>
</figure>
</div>
<div id="fig:opts_per_td" class="fignos">
<figure>
<img src="images/opts_per_td_4.svg" alt="" /><figcaption><span>Figure 15:</span> <strong>Distribution of optimizations per torsion drive</strong>
This figures shows the distributions of optimizations per torsion drive when using wavefront propagation</figcaption>
</figure>
</div>
<div id="fig:full_validation_set" class="fignos">
<figure>
<img src="images/figure-10-SI.svg" alt="" /><figcaption><span>Figure 16:</span> <strong>Validation set</strong>
All molecules used in the validation set of fragmentation schemes. The bonds are highlighted by how sensitive they are to
remote fragmentation. The redder bonds are more sensitive while the WBO distributions around the blue bonds do not change
much with remote fragmentation.</figcaption>
</figure>
</div>
<div id="fig:equal-fragments" class="fignos">
<figure>
<img src="images/SI-pfizer-wbo-equal.svg" alt="" /><figcaption><span>Figure 17:</span> <strong>WBO fragmentation generates minimal fragment</strong>
This figure illustrates some cases where the Pfizer scheme and WBO scheme generate the same minimal fragment. While in most cases these fragments
have WBO distributions that are close to the parent WBO distributions of the highlighted bond, sometimes both minimal fragments are equally poor.
<strong>[A]</strong>, <strong>[B]</strong>, and <strong>[C]</strong> show fragments of both schemes where important remote, chemical groups are not in the fragment so their overlapping distributions (orange and green)
are far from the parent WBO distributions (blue distributions). <strong>[D]</strong>, <strong>[E]</strong>, and <strong>[F]</strong> are the same as <strong>A</strong>, <strong>B</strong> and <strong>C</strong>, but the fragments do have the
important chemical substituents so both perform equally well.</figcaption>
</figure>
</div>
<div id="fig:si-phosphate" class="fignos">
<figure>
<img src="images/SI-phosphate.svg" alt="" /><figcaption><span>Figure 18:</span> <strong>When Phosphate is removed, WBO distribution shifts even when the phosphate is six bonds away</strong>
Examples from benchmark set where remote phophsate groups induce long range effects of <strong>[A]</strong> six bonds away and <strong>[B]</strong> four bonds away.</figcaption>
</figure>
</div>
<div id="fig:si-nitrogen" class="fignos">
<figure>
<img src="images/SI-nitrogen.svg" alt="" /><figcaption><span>Figure 19:</span> <strong>When a protonated nitrogen is removed, WBO distribution shifts even when the nitrogen is up to eight bonds away</strong>
Selected examples from the benchmark set were remote nitrogen groups induce long range effects. The distance of the remote nitrogen
ranges from three bonds away up to eight bonds away.</figcaption>
</figure>
</div>
<div id="fig:si-nitrile" class="fignos">
<figure>
<img src="images/SI-nitrile.svg" alt="" /><figcaption><span>Figure 20:</span> <strong>Removing a nitrile group shifts the WBO distribution.</strong>
Examples from the benchmark set. Removing remote nitrile groups shift the WBO distribution.</figcaption>
</figure>
</div>
<div id="fig:si-sulfonamide" class="fignos">
<figure>
<img src="images/SI-sulfonamide.svg" alt="" /><figcaption><span>Figure 21:</span> <strong>Removing a sulfonamide group shifts WBO distribution.</strong>
Removing the sulfonamide (orange) that is four bonds away moves the fragment’s WBO distribution further away from parent WBO distribution (blue).</figcaption>
</figure>
</div>
<div id="fig:si-oxygen" class="fignos">
<figure>
<img src="images/SI-oxygen.svg" alt="" /><figcaption><span>Figure 22:</span> <strong>Removing a deprotonated oxygen shifts the WBO distribution.</strong>
Removing a negatively charged nitrogen can effect bonds up to six to eight bonds away.</figcaption>
</figure>
</div>
<div id="fig:si-nitro" class="fignos">
<figure>
<img src="images/SI-nitro.svg" alt="" /><figcaption><span>Figure 23:</span> <strong>Removing a ntiro group shifts the WBO distribution.</strong>
Removing a ntiro group effects bonds up to five bonds away.</figcaption>
</figure>
</div>
<div id="fig:si-sulfur" class="fignos">
<figure>
<img src="images/SI-sulfur.svg" alt="" /><figcaption><span>Figure 24:</span> <strong>Removing sulfur shifts the WBO distribution.</strong>
Removing sulfur shifts the WBO, but the shift is smaller than for other functional groups and this is not always captured by the WBO scheme.
The figure on the right shows the fragment that the WBO scheme generates (green), however, it also includes the ring. The smaller fragment that
has the sulfur (red) has an ELF10 WBO that is ~0.1 lower than in the parent, but the WBO distribution (shown in red) is closer to the parent WBO distribution (blue, distance score 0.08)
than the fragment without sulfur (orange, 0.133)</figcaption>
</figure>
</div>
<div id="fig:si-heuristics" class="fignos">
<figure>
<img src="images/SI-heuristic.svg" alt="" /><figcaption><span>Figure 25:</span> <strong>Comparing heuristics for growing out fragment</strong>
<strong>[A]</strong> Distance score and computational cost of fragments generated with the shortest path heuristic.
<strong>[B]</strong> Same as <strong>A</strong> with the greater WBO heuristic.</figcaption>
</figure>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>When performing discrete sampling of the torsional potential, it is desirable to sample near the critical points in order to obtain the qualitatively correct picture of the continuous potential energy curve.
For 2-fold and 4-fold periodic potentials, we expect critical points at 0, 45, and 90 degrees, whereas for 3-fold and 6-fold periodic potentials, critical points are expected at 0, 30, 60, and/or 90 degrees.
Therefore, the 15 degree grid spacing was chosen because it included most points where extrema in the torsional potential are likely to appear.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!-- default theme -->

<style>
    /* import google fonts */
    @import url("https://fonts.googleapis.com/css?family=Open+Sans:400,600,700");
    @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

    /* -------------------------------------------------- */
    /* global */
    /* -------------------------------------------------- */

    /* all elements */
    * {
        /* force sans-serif font unless specified otherwise */
        font-family: "Open Sans", "Helvetica", sans-serif;

        /* prevent text inflation on some mobile browsers */
        -webkit-text-size-adjust: none !important;
        -moz-text-size-adjust: none !important;
        -o-text-size-adjust: none !important;
        text-size-adjust: none !important;
    }

    @media only screen {
        /* "page" element */
        body {
            position: relative;
            box-sizing: border-box;
            font-size: 12pt;
            line-height: 1.5;
            max-width: 8.5in;
            margin: 20px auto;
            padding: 40px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* "page" element */
        body {
            padding: 20px;
            margin: 0;
            border-radius: 0;
            border: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05) inset;
            background: none;
        }
    }

    /* -------------------------------------------------- */
    /* headings */
    /* -------------------------------------------------- */

    /* all headings */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 20px 0;
        padding: 0;
        font-weight: bold;
    }

    /* biggest heading */
    h1 {
        margin: 40px 0;
        text-align: center;
    }

    /* second biggest heading */
    h2 {
        margin-top: 30px;
        padding-bottom: 5px;
        border-bottom: solid 1px #bdbdbd;
    }

    /* -------------------------------------------------- */
    /* manuscript header */
    /* -------------------------------------------------- */

    /* manuscript title */
    header > h1 {
        margin: 0;
    }

    /* manuscript title caption text (ie "automatically generated on") */
    header + p {
        text-align: center;
        margin-top: 10px;
    }

    /* -------------------------------------------------- */
    /* text elements */
    /* -------------------------------------------------- */

    /* links */
    a {
        color: #2196f3;
        overflow-wrap: break-word;
    }

    /* normal links (not empty, not button link, not syntax highlighting link) */
    a:not(:empty):not(.button):not(.sourceLine) {
        padding-left: 1px;
        padding-right: 1px;
    }

    /* superscripts and subscripts */
    sub,
    sup {
        /* prevent from affecting line height */
        line-height: 0;
    }

    /* unordered and ordered lists*/
    ul,
    ol {
        padding-left: 20px;
    }

    /* class for styling text semibold */
    .semibold {
        font-weight: 600;
    }

    /* class for styling elements horizontally left aligned */
    .left {
        display: block;
        text-align: left;
        margin-left: auto;
        margin-right: 0;
        justify-content: left;
    }

    /* class for styling elements horizontally centered */
    .center {
        display: block;
        text-align: center;
        margin-left: auto;
        margin-right: auto;
        justify-content: center;
    }

    /* class for styling elements horizontally right aligned */
    .right {
        display: block;
        text-align: right;
        margin-left: 0;
        margin-right: auto;
        justify-content: right;
    }

    /* -------------------------------------------------- */
    /* section elements */
    /* -------------------------------------------------- */

    /* horizontal divider line */
    hr {
        border: none;
        height: 1px;
        background: #bdbdbd;
    }

    /* paragraphs, horizontal dividers, figures, tables, code */
    p,
    hr,
    figure,
    table,
    pre {
        /* treat all as "paragraphs", with consistent vertical margins */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* figures */
    /* -------------------------------------------------- */

    /* figure */
    figure {
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure caption */
    figcaption {
        padding: 0;
        padding-top: 10px;
    }

    /* figure image element */
    figure img {
        max-width: 100%;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure auto-number */
    img + figcaption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* tables */
    /* -------------------------------------------------- */

    /* table */
    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* table cells */
    th,
    td {
        border: solid 1px #bdbdbd;
        padding: 10px;
        /* squash table if too wide for page by forcing line breaks */
        overflow-wrap: break-word;
        word-break: break-word;
    }

    /* header row and even rows */
    th,
    tr:nth-child(2n) {
        background-color: #fafafa;
    }

    /* odd rows */
    tr:nth-child(2n + 1) {
        background-color: #ffffff;
    }

    /* table caption */
    caption {
        text-align: left;
        padding: 0;
        padding-bottom: 10px;
    }

    /* table auto-number */
    table > caption > span:first-of-type,
    div.table_wrapper > table > caption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* code */
    /* -------------------------------------------------- */

    /* multi-line code block */
    pre {
        padding: 10px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
        break-inside: avoid;
        text-align: left;
    }

    /* inline code, ie code within normal text */
    :not(pre) > code {
        padding: 0 4px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
    }

    /* code text */
    /* apply all children, to reach syntax highlighting sub-elements */
    code,
    code * {
        /* force monospace font */
        font-family: "Source Code Pro", "Courier New", monospace;
    }

    /* -------------------------------------------------- */
    /* quotes */
    /* -------------------------------------------------- */

    /* quoted text */
    blockquote {
        margin: 0;
        padding: 0;
        border-left: 4px solid #bdbdbd;
        padding-left: 16px;
        break-inside: avoid;
    }

    /* -------------------------------------------------- */
    /* banners */
    /* -------------------------------------------------- */

    /* info banners */
    .banner {
        box-sizing: border-box;
        display: block;
        position: relative;
        width: 100%;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 20px;
        text-align: center;
    }

    /* paragraph in banner */
    .banner > p {
        margin: 0;
    }

    /* -------------------------------------------------- */
    /* highlight colors */
    /* -------------------------------------------------- */

    .white {
        background: #ffffff;
    }
    .lightgrey {
        background: #eeeeee;
    }
    .grey {
        background: #757575;
    }
    .darkgrey {
        background: #424242;
    }
    .black {
        background: #000000;
    }
    .lightred {
        background: #ffcdd2;
    }
    .lightyellow {
        background: #ffecb3;
    }
    .lightgreen {
        background: #dcedc8;
    }
    .lightblue {
        background: #e3f2fd;
    }
    .lightpurple {
        background: #f3e5f5;
    }
    .red {
        background: #f44336;
    }
    .orange {
        background: #ff9800;
    }
    .yellow {
        background: #ffeb3b;
    }
    .green {
        background: #4caf50;
    }
    .blue {
        background: #2196f3;
    }
    .purple {
        background: #9c27b0;
    }
    .white,
    .lightgrey,
    .lightred,
    .lightyellow,
    .lightgreen,
    .lightblue,
    .lightpurple,
    .orange,
    .yellow,
    .white a,
    .lightgrey a,
    .lightred a,
    .lightyellow a,
    .lightgreen a,
    .lightblue a,
    .lightpurple a,
    .orange a,
    .yellow a {
        color: #000000;
    }
    .grey,
    .darkgrey,
    .black,
    .red,
    .green,
    .blue,
    .purple,
    .grey a,
    .darkgrey a,
    .black a,
    .red a,
    .green a,
    .blue a,
    .purple a {
        color: #ffffff;
    }

    /* -------------------------------------------------- */
    /* buttons */
    /* -------------------------------------------------- */

    /* class for styling links like buttons */
    .button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        margin: 5px;
        padding: 10px 20px;
        font-size: 0.75em;
        font-weight: 600;
        text-transform: uppercase;
        text-decoration: none;
        letter-spacing: 1px;
        background: none;
        color: #2196f3;
        border: solid 1px #bdbdbd;
        border-radius: 5px;
    }

    /* buttons when hovered */
    .button:hover:not([disabled]),
    .icon_button:hover:not([disabled]) {
        cursor: pointer;
        background: #f5f5f5;
    }

    /* buttons when disabled */
    .button[disabled],
    .icon_button[disabled] {
        opacity: 0.35;
        pointer-events: none;
    }

    /* class for styling buttons containg only single icon */
    .icon_button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        text-decoration: none;
        margin: 0;
        padding: 0;
        background: none;
        border-radius: 5px;
        border: none;
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
    }

    /* icon button inner svg image */
    .icon_button > svg {
        height: 16px;
    }

    /* -------------------------------------------------- */
    /* icons */
    /* -------------------------------------------------- */

    /* class for styling icons inline with text */
    .inline_icon {
        height: 1em;
        position: relative;
        top: 0.125em;
    }

    /* -------------------------------------------------- */
    /* print control */
    /* -------------------------------------------------- */

    @media print {
        @page {
            /* suggested printing margin */
            margin: 0.5in;
        }

        /* document and "page" elements */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        /* "page" element */
        body {
            font-size: 11pt !important;
            line-height: 1.35;
        }

        /* all headings */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 15px 0;
        }

        /* heading 1 */
        h1 {
            font-size: 1.75em;
        }

        /* heading 2 */
        h2 {
            font-size: 1.25em;
            margin-top: 0;
        }

        /* heading 3 */
        h3 {
            font-size: 1.10em;
        }

        /* figures and tables */
        figure, table {
            font-size: 0.85em;
        }

        /* table cells */
        th,
        td {
            padding: 5px;
        }

        /* shrink font awesome icons */
        i.fas,
        i.fab,
        i.far,
        i.fal {
            transform: scale(0.85);
        }

        /* decrease banner margins */
        .banner {
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 15px;
        }

        /* class for centering an element vertically on its own page */
        .page_center {
            margin: auto;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            vertical-align: middle;
            break-before: page;
            break-after: page;
        }

        /* always insert a page break before the element */
        .page_break_before {
            break-before: page;
        }

        /* always insert a page break after the element */
        .page_break_after {
            break-after: page;
        }

        /* avoid page break before the element */
        .page_break_before_avoid {
            break-before: avoid;
        }

        /* avoid page break after the element */
        .page_break_after_avoid {
            break-after: avoid;
        }

        /* avoid page break inside the element */
        .page_break_inside_avoid {
            break-inside: avoid;
        }
    }

    /* -------------------------------------------------- */
    /* override pandoc css quirks */
    /* -------------------------------------------------- */

    .sourceCode {
        /* prevent unsightly overflow in wide code blocks */
        overflow: auto !important;
    }

    div.sourceCode {
        /* prevent background fill on top-most code block  container */
        background: none !important;
    }

    .sourceCode * {
        /* force consistent line spacing */
        line-height: 1.5 !important;
    }

    div.sourceCode {
        /* style code block margins same as <pre> element */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* tablenos */
    /* -------------------------------------------------- */

    /* tablenos wrapper */
    .tablenos {
        /* show scrollbar on tables if necessary to prevent overflow */
        width: 100%;
        margin: 20px 0;
    }

    .tablenos > table {
        /* move margins from table to table_wrapper to allow margin collapsing */
        margin: 0;
    }

    @media only screen {
        /* tablenos wrapper */
        .tablenos {
            /* show scrollbar on tables if necessary to prevent overflow */
            overflow-x: auto !important;
        }

        .tablenos th,
        .tablenos td {
            overflow-wrap: unset !important;
            word-break: unset !important;
        }

        /* table in wrapper */
        .tablenos table,
        .tablenos table * {
            /* don't break table words */
            overflow-wrap: normal !important;
        }
    }

    /* -------------------------------------------------- */
    /* mathjax */
    /* -------------------------------------------------- */

    /* mathjax containers */
    .math.display > span:not(.MathJax_Preview) {
        /* turn inline element (no dimensions) into block (allows fixed width and thus scrolling) */
        display: flex !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        justify-content: center;
        align-items: center;
        margin: 0 !important;
    }

    /* right click menu */
    .MathJax_Menu {
        border-radius: 5px !important;
        border: solid 1px #bdbdbd !important;
        box-shadow: none !important;
    }

    /* equation auto-number */
    span[id^="eq:"] > span.math.display + span {
        font-weight: 600;
    }

    /* equation */
    span[id^="eq:"] > span.math.display > span {
        /* nudge to make room for equation auto-number and anchor */
        margin-right: 60px !important;
    }

    /* -------------------------------------------------- */
    /* anchors plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anchor button */
        .anchor {
            opacity: 0;
            margin-left: 5px;
        }

        /* anchor buttons within <h2>'s */
        h2 .anchor {
            margin-left: 10px;
        }

        /* anchor buttons when hovered/focused and anything containing an anchor button when hovered */
        *:hover > .anchor,
        .anchor:hover,
        .anchor:focus {
            opacity: 1;
        }

        /* anchor button when hovered */
        .anchor:hover {
            cursor: pointer;
        }
    }

    /* always show anchor button on devices with no mouse/hover ability */
    @media (hover: none) {
        .anchor {
            opacity: 1;
        }
    }

    /* always hide anchor button on print */
    @media only print {
        .anchor {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* accordion plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* accordion arrow button */
        .accordion_arrow {
            margin-right: 10px;
        }

        /* arrow icon when <h2> data-collapsed attribute true */
        h2[data-collapsed="true"] > .accordion_arrow > svg {
            transform: rotate(-90deg);
        }

        /* all elements (except <h2>'s) when data-collapsed attribute true */
        *:not(h2)[data-collapsed="true"] {
            display: none;
        }

        /* accordion arrow button when hovered and <h2>'s when hovered */
        .accordion_arrow:hover,
        h2[data-collapsed="true"]:hover,
        h2[data-collapsed="false"]:hover {
            cursor: pointer;
        }
    }

    /* always hide accordion arrow button on print */
    @media only print {
        .accordion_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* tooltips plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* tooltip container */
        #tooltip {
            position: absolute;
            width: 50%;
            min-width: 240px;
            max-width: 75%;
            z-index: 1;
        }

        /* tooltip content */
        #tooltip_content {
            margin-bottom: 5px;
            padding: 20px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
            overflow-wrap: break-word;
        }

        /* tooltip copy of paragraphs and figures */
        #tooltip_content > p,
        #tooltip_content > figure {
            margin: 0;
            max-height: 320px;
            overflow-y: auto;
        }

        /* tooltip copy of <img> */
        #tooltip_content > figure > img {
            max-height: 260px;
        }

        /* navigation bar */
        #tooltip_nav_bar {
            margin-top: 10px;
            text-align: center;
        }

        /* navigation bar previous/next buton */
        #tooltip_nav_bar > .icon_button {
            position: relative;
            top: 3px;
        }

        /* navigation bar previous button */
        #tooltip_nav_bar > .icon_button:first-of-type {
            margin-right: 5px;
        }

        /* navigation bar next button */
        #tooltip_nav_bar > .icon_button:last-of-type {
            margin-left: 5px;
        }
    }

    /* always hide tooltip on print */
    @media only print {
        #tooltip {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* jump to first plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* jump button */
        .jump_arrow {
            position: relative;
            top: 0.125em;
            margin-right: 5px;
        }
    }

    /* always hide jump button on print */
    @media only print {
        .jump_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* link highlight plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anything with data-highlighted attribute true */
        [data-highlighted="true"] {
            background: #ffeb3b;
        }

        /* anything with data-selected attribute true */
        [data-selected="true"] {
            background: #ff8a65 !important;
        }

        /* animation definition for glow */
        @keyframes highlight_glow {
            0% {
                background: none;
            }
            10% {
                background: #bbdefb;
            }
            100% {
                background: none;
            }
        }

        /* anything with data-glow attribute true */
        [data-glow="true"] {
            animation: highlight_glow 2s;
        }
    }

    /* -------------------------------------------------- */
    /* table of contents plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* toc panel */
        #toc_panel {
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            background: #ffffff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            z-index: 2;
        }

        /* toc panel when closed */
        #toc_panel[data-open="false"] {
            min-width: 60px;
            width: 60px;
            height: 60px;
            border-right: solid 1px #bdbdbd;
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc panel when open */
        #toc_panel[data-open="true"] {
            min-width: 260px;
            max-width: 480px;
            /* keep panel edge consistent distance away from "page" edge */
            width: calc(((100vw - 8.5in) / 2) - 30px - 40px);
            bottom: 0;
            border-right: solid 1px #bdbdbd;
        }

        /* toc panel header */
        #toc_header {
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
            align-items: center;
            height: 60px;
            margin: 0;
            padding: 20px;
        }

        /* toc panel header when hovered */
        #toc_header:hover {
            cursor: pointer;
        }

        /* toc panel header when panel open */
        #toc_panel[data-open="true"] > #toc_header {
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc open/close header button */
        #toc_button {
            margin-right: 20px;
        }

        /* hide toc list and header text when closed */
        #toc_panel[data-open="false"] > #toc_header > *:not(#toc_button),
        #toc_panel[data-open="false"] > #toc_list {
            display: none;
        }

        /* toc list of entries */
        #toc_list {
            box-sizing: border-box;
            width: 100%;
            padding: 20px;
            position: absolute;
            top: calc(60px + 1px);
            bottom: 0;
            overflow: auto;
        }

        /* toc entry, link to section in document */
        .toc_link {
            display: block;
            padding: 5px;
            position: relative;
            font-weight: 600;
            text-decoration: none;
        }

        /* toc entry when hovered or when "viewed" */
        .toc_link:hover,
        .toc_link[data-viewing="true"] {
            background: #f5f5f5;
        }

        /* toc entry, level 1 indentation */
        .toc_link[data-level="1"] {
            margin-left: 0;
        }

        /* toc entry, level 2 indentation */
        .toc_link[data-level="2"] {
            margin-left: 20px;
        }

        /* toc entry, level 3 indentation */
        .toc_link[data-level="3"] {
            margin-left: 40px;
        }

        /* toc entry, level 4 indentation */
        .toc_link[data-level="4"] {
            margin-left: 60px;
        }

        /* toc entry bullets */
        #toc_panel[data-bullets="true"] .toc_link[data-level]:before {
            position: absolute;
            left: -15px;
            top: -1px;
            font-size: 1.5em;
        }

        /* toc entry, level 2 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="2"]:before {
            content: "\2022";
        }

        /* toc entry, level 3 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="3"]:before {
            content: "\25AB";
        }

        /* toc entry, level 4 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="4"]:before {
            content: "-";
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* push <body> ("page") element down to make room for toc icon */
        .toc_body_nudge {
            padding-top: 60px;
        }

        /* toc icon when panel closed and not hovered */
        #toc_panel[data-open="false"]:not(:hover) {
            background: rgba(255, 255, 255, 0.75);
        }
    }

    /* always hide toc panel on print */
    @media only print {
        #toc_panel {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* lightbox plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* regular <img> in document when hovered */
        .lightbox_document_img:hover {
            cursor: pointer;
        }

        .body_no_scroll {
            overflow: hidden !important;
        }

        /* screen overlay */
        #lightbox_overlay {
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 3;
        }

        /* middle area containing lightbox image */
        #lightbox_image_container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            padding: 20px;
        }

        /* bottom area containing caption */
        #lightbox_bottom_container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            min-height: 100px;
            max-height: 100px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* image number info text box */
        #lightbox_number_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            left: 2px;
            top: 0;
            z-index: 4;
        }

        /* zoom info text box */
        #lightbox_zoom_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            right: 2px;
            top: 0;
            z-index: 4;
        }

        /* copy of image caption */
        #lightbox_caption {
            box-sizing: border-box;
            display: inline-block;
            width: 100%;
            max-height: 100%;
            padding: 10px 0;
            text-align: center;
            overflow-y: auto;
            color: #ffffff;
        }

        /* navigation previous/next button */
        .lightbox_button {
            width: 100px;
            height: 100%;
            min-width: 100px;
            min-height: 100%;
            color: #ffffff;
        }

        /* navigation previous/next button when hovered */
        .lightbox_button:hover {
            background: none !important;
        }

        /* navigation button icon */
        .lightbox_button > svg {
            height: 25px;
        }

        /* figure auto-number */
        #lightbox_caption > span:first-of-type {
            font-weight: bold;
            margin-right: 5px;
        }

        /* lightbox image when hovered */
        #lightbox_img:hover {
            cursor: grab;
        }

        /* lightbox image when grabbed */
        #lightbox_img:active {
            cursor: grabbing;
        }
    }

    /* when on screen < 480px wide */
    @media only screen and (max-width: 480px) {
        /* make navigation buttons skinnier on small screens to make more room for caption text */
        .lightbox_button {
            width: 50px;
            min-width: 50px;
        }
    }

    /* always hide lightbox on print */
    @media only print {
        #lightbox_overlay {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* hypothesis (annotations) plugin */
    /* -------------------------------------------------- */

    /* side panel */
    .annotator-frame {
        width: 280px !important;
        z-index: 0 !important;
    }

    /* match highlight color to rest of theme */
    .annotator-highlights-always-on .annotator-hl {
        background-color: #ffeb3b !important;
    }

    /* match focused color to rest of theme */
    .annotator-hl.annotator-hl-focused {
        background-color: #ff8a65 !important;
    }

    /* match bucket bar color to rest of theme */
    .annotator-bucket-bar {
        background: #f5f5f5 !important;
    }

    /* always hide toolbar and tooltip on print */
    @media only print {
        .annotator-frame {
            display: none !important;
        }

        hypothesis-adder {
            display: none !important;
        }
    }
</style>
<!-- anchors plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds an anchor next to each of a certain type
        // of element that provides a human-readable url to that specific
        // item/position in the document (eg "manuscript.html#abstract"). It
        // also makes it such that scrolling out of view of a target removes
        // its identifier from the url.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'anchors';

        // default plugin options
        const options = {
            // which types of elements to add anchors next to, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3, [id^="fig:"], [id^="tbl:"], [id^="eq:"]',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // add anchor to each element of specified types
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements)
                addAnchor(element);

            // attach scroll listener to window
            window.addEventListener('scroll', onScroll);
        }

        // when window is scrolled
        function onScroll() {
            // if url has hash and user has scrolled out of view of hash
            // target, remove hash from url
            const tolerance = 100;
            const target = getHashTarget();
            if (target) {
                if (
                    target.getBoundingClientRect().top >
                        window.innerHeight + tolerance ||
                    target.getBoundingClientRect().bottom < 0 - tolerance
                )
                    history.pushState(null, null, ' ');
            }
        }

        // add anchor to element
        function addAnchor(element) {
            let addTo; // element to add anchor button to

            // if figure or table, modify withId and addTo to get expected
            // elements
            if (element.id.indexOf('fig:') === 0) {
                addTo = element.querySelector('figcaption');
            } else if (element.id.indexOf('tbl:') === 0) {
                addTo = element.querySelector('caption');
            } else if (element.id.indexOf('eq:') === 0) {
                addTo = element.querySelector('.eqnos-number');
            }

            addTo = addTo || element;
            const id = element.id || null;

            // do not add anchor if element doesn't have assigned id.
            // id is generated by pandoc and is assumed to be unique and
            // human-readable
            if (!id)
                return;

            // create anchor button
            const anchor = document.createElement('a');
            anchor.innerHTML = document.querySelector('.icon_link').innerHTML;
            anchor.title = 'Link to this part of the document';
            anchor.classList.add('icon_button', 'anchor');
            anchor.dataset.ignore = 'true';
            anchor.href = '#' + id;
            addTo.appendChild(anchor);
        }

        // get element that is target of link or url hash
        function getHashTarget() {
            const hash = window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');
            if (id.indexOf('tbl:') === 0)
                target = target.querySelector('table');

            return target;
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- link icon -->

<template class="icon_link">
    <!-- modified from: https://fontawesome.com/icons/link -->
    <svg width="16" height="16" viewBox="0 0 512 512">
        <path
            fill="currentColor"
            d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"
        ></path>
    </svg>
</template>
<!-- accordion plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows sections of content under <h2> headings
        // to be collapsible.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'accordion';

        // default plugin options
        const options = {
            // whether to always start expanded ('false'), always start
            // collapsed ('true'), or start collapsed when screen small ('auto')
            startCollapsed: 'auto',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <h2> heading
            const headings = document.querySelectorAll('h2');
            for (const heading of headings) {
                addArrow(heading);

                // start expanded/collapsed based on option
                if (
                    options.startCollapsed === 'true' ||
                    (options.startCollapsed === 'auto' && isSmallScreen())
                )
                    collapseHeading(heading);
                else
                    expandHeading(heading);
            }

            // attach hash change listener to window
            window.addEventListener('hashchange', onHashChange);
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                goToElement(target);
        }

        // add arrow to heading
        function addArrow(heading) {
            // add arrow button
            const arrow = document.createElement('button');
            arrow.innerHTML = document.querySelector(
                '.icon_angle_down'
            ).innerHTML;
            arrow.classList.add('icon_button', 'accordion_arrow');
            heading.insertBefore(arrow, heading.firstChild);

            // attach click listener to heading and button
            heading.addEventListener('click', onHeadingClick);
            arrow.addEventListener('click', onArrowClick);
        }

        // determine if on mobile-like device with small screen
        function isSmallScreen() {
            return Math.min(window.innerWidth, window.innerHeight) < 480;
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get element that is target of hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');
            if (id.indexOf('tbl:') === 0)
                target = target.querySelector('table');

            return target;
        }

        // when <h2> heading is clicked
        function onHeadingClick(event) {
            // only collapse if <h2> itself is target of click (eg, user did
            // not click on anchor within <h2>)
            if (event.target === this)
                toggleCollapse(this);
        }

        // when arrow button is clicked
        function onArrowClick() {
            toggleCollapse(this.parentNode);
        }

        // collapse section if expanded, expand if collapsed
        function toggleCollapse(heading) {
            if (heading.dataset.collapsed === 'false')
                collapseHeading(heading);
            else
                expandHeading(heading);
        }

        // elements to exclude from collapse, such as table of contents panel,
        // hypothesis panel, etc
        const exclude = '#toc_panel, div.annotator-frame, #lightbox_overlay';

        // collapse section
        function collapseHeading(heading) {
            heading.setAttribute('data-collapsed', 'true');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'true');
        }

        // expand section
        function expandHeading(heading) {
            heading.setAttribute('data-collapsed', 'false');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'false');
        }

        // get list of elements between this <h2> and next <h2> or <h1>
        // ("children" of the <h2> section)
        function getChildren(heading) {
            return nextUntil(heading, 'h2, h1', exclude);
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get list of elements after a start element up to element matching
        // query
        function nextUntil(element, query, exclude) {
            const elements = [];
            while (element = element.nextElementSibling, element) {
                if (element.matches(query))
                    break;
                if (!element.matches(exclude))
                    elements.push(element);
            }
            return elements;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle down icon -->

<template class="icon_angle_down">
    <!-- modified from: https://fontawesome.com/icons/angle-down -->
    <svg width="16" height="16" viewBox="0 0 448 512">
        <path
            fill="currentColor"
            d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"
        ></path>
    </svg>
</template>
<!-- tooltips plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when the user hovers or
        // focuses a link to a citation or figure, a tooltip appears with a
        // preview of the reference content, along with arrows to navigate
        // between instances of the same reference in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tooltips';

        // default plugin options
        const options = {
            // whether user must click off to close tooltip instead of just
            // un-hovering
            clickClose: 'false',
            // delay (in ms) between opening and closing tooltip
            delay: '100',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach hover and focus listeners to link
                link.addEventListener('mouseover', onLinkHover);
                link.addEventListener('mouseleave', onLinkUnhover);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('touchend', onLinkTouch);
            }

            // attach mouse, key, and resize listeners to window
            window.addEventListener('mousedown', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('keyup', onKeyUp);
            window.addEventListener('resize', onResize);
        }

        // when link is hovered
        function onLinkHover() {
            // function to open tooltip
            const delayOpenTooltip = function() {
                openTooltip(this);
            }.bind(this);

            // run open function after delay
            this.openTooltipTimer = window.setTimeout(
                delayOpenTooltip,
                options.delay
            );
        }

        // when mouse leaves link
        function onLinkUnhover() {
            // cancel opening tooltip
            window.clearTimeout(this.openTooltipTimer);

            // don't close on unhover if option specifies
            if (options.clickClose === 'true')
                return;

            // function to close tooltip
            const delayCloseTooltip = function() {
                // if tooltip open and if mouse isn't over tooltip, close
                const tooltip = document.getElementById('tooltip');
                if (tooltip && !tooltip.matches(':hover'))
                    closeTooltip();
            };

            // run close function after delay
            this.closeTooltipTimer = window.setTimeout(
                delayCloseTooltip,
                options.delay
            );
        }

        // when link is focused (tabbed to)
        function onLinkFocus(event) {
            openTooltip(this);
        }

        // when link is touched on touch screen
        function onLinkTouch(event) {
            // attempt to force hover state on first tap always, and trigger
            // regular link click (and navigation) on second tap
            if (event.target === document.activeElement)
                event.target.click();
            else {
                document.activeElement.blur();
                event.target.focus();
            }
            if (event.cancelable)
                event.preventDefault();
            event.stopPropagation();
            return false;
        }

        // when mouse is clicked anywhere in window
        function onClick(event) {
            closeTooltip();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'tooltip_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'tooltip_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeTooltip();
                    break;
            }
        }

        // when window is resized or zoomed
        function onResize() {
            closeTooltip();
        }

        // get all links of types we wish to handle
        function getLinks() {
            const queries = [];
            // exclude buttons, anchor links, toc links, etc
            const exclude =
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            queries.push('a[href^="#ref-"]' + exclude); // citation links
            queries.push('a[href^="#fig:"]' + exclude); // figure links
            const query = queries.join(', ');
            return document.querySelectorAll(query);
        }

        // get links with same target, get index of link in set, get total
        // same links
        function getSameLinks(link) {
            const sameLinks = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    sameLinks.push(otherLink);
            }

            return {
                elements: sameLinks,
                index: sameLinks.indexOf(link),
                total: sameLinks.length
            };
        }

        // open tooltip
        function openTooltip(link) {
            // delete tooltip if it exists, start fresh
            closeTooltip();

            // make tooltip element
            const tooltip = makeTooltip(link);

            // if source couldn't be found and tooltip not made, exit
            if (!tooltip)
                return;

            // make navbar elements
            const navBar = makeNavBar(link);
            if (navBar)
                tooltip.firstElementChild.appendChild(navBar);

            // attach tooltip to page
            document.body.appendChild(tooltip);

            // position tooltip
            const position = function() {
                positionTooltip(link);
            };
            position();

            // if tooltip contains images, position again after they've loaded
            const imgs = tooltip.querySelectorAll('img');
            for (const img of imgs)
                img.addEventListener('load', position);
        }

        // close (delete) tooltip
        function closeTooltip() {
            const tooltip = document.getElementById('tooltip');
            if (tooltip)
                tooltip.remove();
        }

        // make tooltip
        function makeTooltip(link) {
            // get target element that link points to
            const source = getSource(link);

            // if source can't be found, exit
            if (!source)
                return;

            // create new tooltip
            const tooltip = document.createElement('div');
            tooltip.id = 'tooltip';
            const tooltipContent = document.createElement('div');
            tooltipContent.id = 'tooltip_content';
            tooltip.appendChild(tooltipContent);

            // make copy of source node and put in tooltip
            const sourceCopy = makeCopy(source);
            tooltipContent.appendChild(sourceCopy);

            // attach mouse event listeners
            tooltip.addEventListener('click', onTooltipClick);
            tooltip.addEventListener('mousedown', onTooltipClick);
            tooltip.addEventListener('touchstart', onTooltipClick);
            tooltip.addEventListener('mouseleave', onTooltipUnhover);

            // (for interaction with lightbox plugin)
            // transfer click on tooltip copied img to original img
            const sourceImg = source.querySelector('img');
            const sourceCopyImg = sourceCopy.querySelector('img');
            if (sourceImg && sourceCopyImg) {
                const clickImg = function() {
                    sourceImg.click();
                    closeTooltip();
                };
                sourceCopyImg.addEventListener('click', clickImg);
            }

            return tooltip;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // when tooltip is clicked
        function onTooltipClick(event) {
            // when user clicks on tooltip, stop click from transferring
            // outside of tooltip (eg, click off to close tooltip, or eg click
            // off to unhighlight same refs)
            event.stopPropagation();
        }

        // when tooltip is unhovered
        function onTooltipUnhover(event) {
            if (options.clickClose === 'true')
                return;

            // make sure new mouse/touch/focus no longer over tooltip or any
            // element within it
            const tooltip = document.getElementById('tooltip');
            if (!tooltip)
                return;
            if (this.contains(event.relatedTarget))
                return;

            closeTooltip();
        }

        // make nav bar to go betwen prev/next instances of same reference
        function makeNavBar(link) {
            // find other links to the same source
            const sameLinks = getSameLinks(link);

            // don't show nav bar when singular reference
            if (sameLinks.total <= 1)
                return;

            // find prev/next links with same target
            const prevLink = getPrevLink(link, sameLinks);
            const nextLink = getNextLink(link, sameLinks);

            // create nav bar
            const navBar = document.createElement('div');
            navBar.id = 'tooltip_nav_bar';
            const text = sameLinks.index + 1 + ' of ' + sameLinks.total;

            // create nav bar prev/next buttons
            const prevButton = document.createElement('button');
            const nextButton = document.createElement('button');
            prevButton.id = 'tooltip_prev_button';
            nextButton.id = 'tooltip_next_button';
            prevButton.title =
                'Jump to the previous occurence of this item in the document [←]';
            nextButton.title =
                'Jump to the next occurence of this item in the document [→]';
            prevButton.classList.add('icon_button');
            nextButton.classList.add('icon_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;
            navBar.appendChild(prevButton);
            navBar.appendChild(document.createTextNode(text));
            navBar.appendChild(nextButton);

            // attach click listeners to buttons
            prevButton.addEventListener('click', function() {
                onPrevNextClick(link, prevLink);
            });
            nextButton.addEventListener('click', function() {
                onPrevNextClick(link, nextLink);
            });

            return navBar;
        }

        // get previous link with same target
        function getPrevLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if < 1
            let index;
            if (sameLinks.index - 1 >= 0)
                index = sameLinks.index - 1;
            else
                index = sameLinks.total - 1;
            return sameLinks.elements[index];
        }

        // get next link with same target
        function getNextLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if > total
            let index;
            if (sameLinks.index + 1 <= sameLinks.total - 1)
                index = sameLinks.index + 1;
            else
                index = 0;
            return sameLinks.elements[index];
        }

        // get element that is target of link or url hash
        function getSource(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if ref or figure, modify target to get expected element
            if (id.indexOf('ref-') === 0)
                target = target.querySelector('p');
            else if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');

            return target;
        }

        // when prev/next arrow button is clicked
        function onPrevNextClick(link, prevNextLink) {
            if (link && prevNextLink)
                goToElement(prevNextLink, window.innerHeight * 0.5);
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // determine position to place tooltip based on link position in
        // viewport and tooltip size
        function positionTooltip(link, left, top) {
            const tooltipElement = document.getElementById('tooltip');
            if (!tooltipElement)
                return;

            // get convenient vars for position/dimensions of
            // link/tooltip/page/view
            link = getRectInPage(link);
            const tooltip = getRectInPage(tooltipElement);
            const view = getRectInPage();

            // horizontal positioning
            if (left)
                // use explicit value
                left = left;
            else if (link.left + tooltip.width < view.right)
                // fit tooltip to right of link
                left = link.left;
            else if (link.right - tooltip.width > view.left)
                // fit tooltip to left of link
                left = link.right - tooltip.width;
            // center tooltip in view
            else
                left = (view.right - view.left) / 2 - tooltip.width / 2;

            // vertical positioning
            if (top)
                // use explicit value
                top = top;
            else if (link.top - tooltip.height > view.top)
                // fit tooltip above link
                top = link.top - tooltip.height;
            else if (link.bottom + tooltip.height < view.bottom)
                // fit tooltip below link
                top = link.bottom;
            else {
                // center tooltip in view
                top = view.top + view.height / 2 - tooltip.height / 2;
                // nudge off of link to left/right if possible
                if (link.right + tooltip.width < view.right)
                    left = link.right;
                else if (link.left - tooltip.width > view.left)
                    left = link.left - tooltip.width;
            }

            tooltipElement.style.left = left + 'px';
            tooltipElement.style.top = top + 'px';
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get position of element relative to page
        function getRectInPage(element) {
            const rect = getRectInView(element);
            const body = getRectInView(document.body);

            const newRect = {};
            newRect.left = rect.left - body.left;
            newRect.top = rect.top - body.top;
            newRect.right = rect.right - body.left;
            newRect.bottom = rect.bottom - body.top;
            newRect.width = rect.width;
            newRect.height = rect.height;

            return newRect;
        }

        // (for interaction with accordion plugin)
        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // (for interaction with accordion plugin)
        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- jump to first plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds a button next to each reference entry,
        // figure, and table that jumps the page to the first occurrence of a
        // link to that item in the manuscript.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'jumpToFirst';

        // default plugin options
        const options = {
            // whether to add buttons next to reference entries
            references: 'true',
            // whether to add buttons next to figures
            figures: 'true',
            // whether to add buttons next to tables
            tables: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            if (options.references !== 'false')
                makeReferenceButtons();
            if (options.figures !== 'false')
                makeFigureButtons();
            if (options.tables !== 'false')
                makeTableButtons();
        }

        // when jump button clicked
        function onButtonClick() {
            const first = getFirstOccurrence(this.dataset.id);
            if (!first)
                return;

            // update url hash so navigating "back" in history will return
            // user to jump button
            window.location.hash = this.dataset.id;
            // scroll to link
            window.setTimeout(function() {
                goToElement(first, window.innerHeight * 0.5);
            }, 0);
        }

        // get first occurence of link to item in document
        function getFirstOccurrence(id) {
            let query = 'a';
            query += '[href="#' + id + '"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelector(query);
        }

        // add button next to each reference entry
        function makeReferenceButtons() {
            const references = document.querySelectorAll('div[id^="ref-"]');
            for (const reference of references) {
                // get reference id and element to add button to
                const id = reference.id;
                const container = reference.firstElementChild;
                const first = getFirstOccurrence(id);

                // if can't find link to reference, ignore
                if (!first)
                    continue;

                // make jump button
                let button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this reference in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.innerHTML = button.outerHTML + container.innerHTML;
                button = container.firstElementChild;
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeFigureButtons() {
            const figures = document.querySelectorAll('[id^="fig:"]');
            for (const figure of figures) {
                // get figure id and element to add button to
                const id = figure.id;
                const container = figure.querySelector('figcaption') || figure;
                const first = getFirstOccurrence(id);

                // if can't find link to figure, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this figure in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeTableButtons() {
            const tables = document.querySelectorAll('[id^="tbl:"]');
            for (const table of tables) {
                // get ref id and element to add button to
                const id = table.id;
                const container = table.querySelector('caption') || table;
                const first = getFirstOccurrence(id);

                // if can't find link to table, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this table in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle double up icon -->

<template class="icon_angle_double_up">
    <!-- modified from: https://fontawesome.com/icons/angle-double-up -->
    <svg width="16" height="16" viewBox="0 0 320 512">
        <path
            fill="currentColor"
            d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"
        ></path>
    </svg>
</template>
<!-- link highlight plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user hovers or
        // focuses a link, other links that have the same target will be
        // highlighted. It also makes it such that when clicking a link, the
        // target of the link (eg reference, figure, table) is briefly
        // highlighted.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'linkHighlight';

        // default plugin options
        const options = {
            // whether to also highlight links that go to external urls
            externalLinks: 'false',
            // whether user must click off to unhighlight instead of just
            // un-hovering
            clickUnhighlight: 'false',
            // whether to also highlight links that are unique
            highlightUnique: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach mouse and focus listeners to link
                link.addEventListener('mouseenter', onLinkFocus);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('mouseleave', onLinkUnhover);
            }

            // attach click and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('hashchange', onHashChange);

            // run hash change on window load in case user has navigated
            // directly to hash
            onHashChange();
        }

        // when link is focused (tabbed to) or hovered
        function onLinkFocus() {
            highlight(this);
        }

        // when link is unhovered
        function onLinkUnhover() {
            if (options.clickUnhighlight !== 'true')
                unhighlightAll();
        }

        // when the mouse is clicked anywhere in window
        function onClick(event) {
            unhighlightAll();
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                glowElement(target);
        }

        // get element that is target of link or url hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            return target;
        }

        // start glow sequence on an element
        function glowElement(element) {
            const startGlow = function() {
                onGlowEnd();
                element.dataset.glow = 'true';
                element.addEventListener('animationend', onGlowEnd);
            };
            const onGlowEnd = function() {
                element.removeAttribute('data-glow');
                element.removeEventListener('animationend', onGlowEnd);
            };
            startGlow();
        }

        // highlight link and all others with same target
        function highlight(link) {
            // force unhighlight all to start fresh
            unhighlightAll();

            // get links with same target
            if (!link)
                return;
            const sameLinks = getSameLinks(link);

            // if link unique and option is off, exit and don't highlight
            if (sameLinks.length <= 1 && options.highlightUnique !== 'true')
                return;

            // highlight all same links, and "select" (special highlight) this
            // one
            for (const sameLink of sameLinks) {
                if (sameLink === link)
                    sameLink.setAttribute('data-selected', 'true');
                else
                    sameLink.setAttribute('data-highlighted', 'true');
            }
        }

        // unhighlight all links
        function unhighlightAll() {
            const links = getLinks();
            for (const link of links) {
                link.setAttribute('data-selected', 'false');
                link.setAttribute('data-highlighted', 'false');
            }
        }

        // get links with same target
        function getSameLinks(link) {
            const results = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    results.push(otherLink);
            }
            return results;
        }

        // get all links of types we wish to handle
        function getLinks() {
            let query = 'a';
            if (options.externalLinks !== 'true')
                query += '[href^="#"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelectorAll(query);
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- table of contents plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin provides a "table of contents" (toc) panel on
        // the side of the document that allows the user to conveniently
        // navigate between sections of the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tableOfContents';

        // default plugin options
        const options = {
            // which types of elements to add links for, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3',
            // whether default behavior is to be closed ('false'), open
            // ('true'), or only open when screen wide enough to fit panel
            // ('auto'). note: still always starts closed when page loads.
            open: 'auto',
            // if list item is more than this many characters, text will be
            // truncated
            charLimit: '50',
            // whether or not to show bullets next to each toc item
            bullets: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // make toc panel and populate with entries (links to document
            // sections)
            const panel = makePanel();
            if (!panel)
                return;
            makeEntries(panel);
            document.body.insertBefore(panel, document.body.firstChild);

            closePanel();

            // attach click, scroll, and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('scroll', onScroll);
            window.addEventListener('hashchange', onScroll);
            window.addEventListener('keyup', onKeyUp);
            onScroll();

            // add class to push document body down out of way of toc button
            document.body.classList.add('toc_body_nudge');
        }

        // determine if screen wide enough to fit toc panel
        function isSmallScreen() {
            // in default theme:
            // 816px = 8.5in = width of "page" (<body>) element
            // 260px = min width of toc panel (*2 for both sides of <body>)
            return window.innerWidth < 816 + 260 * 2;
        }

        // open/close panel based on option and screen size
        function openOrClosePanel() {
            if (
                options.open === 'true' ||
                (options.open === 'auto' && !isSmallScreen())
            )
                openPanel();
            else
                closePanel();
        }

        // when mouse is clicked anywhere in window
        function onClick() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                openOrClosePanel();
        }

        // when window is scrolled or hash changed
        function onScroll() {
            highlightViewed();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            // close on esc
            if (event.key === 'Escape')
                closePanel();
        }

        // find entry of currently viewed document section in toc and highlight
        function highlightViewed() {
            const firstId = getFirstInView(options.typesQuery);

            // get toc entries (links), unhighlight all, then highlight viewed
            const list = document.getElementById('toc_list');
            if (!firstId || !list)
                return;
            const links = list.querySelectorAll('a');
            for (const link of links)
                link.dataset.viewing = 'false';
            const link = list.querySelector('a[href="#' + firstId + '"]');
            if (!link)
                return;
            link.dataset.viewing = 'true';
        }

        // get first or previous toc listed element in top half of view
        function getFirstInView(query) {
            // get all elements matching query and with id
            const elements = document.querySelectorAll(query);
            const elementsWithIds = [];
            for (const element of elements) {
                if (element.id)
                    elementsWithIds.push(element);
            }


            // get first or previous element in top half of view
            for (let i = 0; i < elementsWithIds.length; i++) {
                const element = elementsWithIds[i];
                const prevElement = elementsWithIds[Math.max(0, i - 1)];
                if (element.getBoundingClientRect().top >= 0) {
                    if (
                        element.getBoundingClientRect().top <
                        window.innerHeight / 2
                    )
                        return element.id;
                    else
                        return prevElement.id;
                }
            }
        }

        // make panel
        function makePanel() {
            // create panel
            const panel = document.createElement('div');
            panel.id = 'toc_panel';
            if (options.bullets === 'true')
                panel.dataset.bullets = 'true';

            // create header
            const header = document.createElement('div');
            header.id = 'toc_header';

            // create toc button
            const button = document.createElement('button');
            button.id = 'toc_button';
            button.innerHTML = document.querySelector(
                '.icon_th_list'
            ).innerHTML;
            button.classList.add('icon_button');

            // create header text
            const text = document.createElement('h3');
            text.innerHTML = 'Table of Contents';

            // create container for toc list
            const list = document.createElement('div');
            list.id = 'toc_list';

            // attach click listeners
            panel.addEventListener('click', onPanelClick);
            header.addEventListener('click', onHeaderClick);
            button.addEventListener('click', onButtonClick);

            // attach elements
            header.appendChild(button);
            header.appendChild(text);
            panel.appendChild(header);
            panel.appendChild(list);

            return panel;
        }

        // create toc entries (links) to each element of the specified types
        function makeEntries(panel) {
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements) {
                // do not add link if element doesn't have assigned id
                if (!element.id)
                    continue;

                // create link/list item
                const link = document.createElement('a');
                link.classList.add('toc_link');
                switch (element.tagName.toLowerCase()) {
                    case 'h1':
                        link.dataset.level = '1';
                        break;
                    case 'h2':
                        link.dataset.level = '2';
                        break;
                    case 'h3':
                        link.dataset.level = '3';
                        break;
                    case 'h4':
                        link.dataset.level = '4';
                        break;
                }
                link.title = element.innerText;
                let text = element.innerText;
                if (text.length > options.charLimit)
                    text = text.slice(0, options.charLimit) + '...';
                link.innerHTML = text;
                link.href = '#' + element.id;
                link.addEventListener('click', onLinkClick);

                // attach link
                panel.querySelector('#toc_list').appendChild(link);
            }
        }

        // when panel is clicked
        function onPanelClick(event) {
            // stop click from propagating to window/document and closing panel
            event.stopPropagation();
        }

        // when header itself is clicked
        function onHeaderClick(event) {
            togglePanel();
        }

        // when button is clicked
        function onButtonClick(event) {
            togglePanel();
            // stop header underneath button from also being clicked
            event.stopPropagation();
        }

        // when link is clicked
        function onLinkClick() {
            openOrClosePanel();
        }

        // open panel if closed, close if opened
        function togglePanel() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                closePanel();
            else
                openPanel();
        }

        // open panel
        function openPanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'true';
        }

        // close panel
        function closePanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'false';
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- th list icon -->

<template class="icon_th_list">
    <!-- modified from: https://fontawesome.com/icons/th-list -->
    <svg width="16" height="16" viewBox="0 0 512 512" tabindex="-1">
        <path
            fill="currentColor"
            d="M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
            tabindex="-1"
        ></path>
    </svg>
</template>
<!-- lightbox plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user clicks on an
        // image, the image fills the screen and the user can pan/drag/zoom
        // the image and navigate between other images in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'lightbox';

        // default plugin options
        const options = {
            // list of possible zoom/scale factors
            zoomSteps:
                '0.1, 0.25, 0.333333, 0.5, 0.666666, 0.75, 1,' +
                '1.25, 1.5, 1.75, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8',
            // whether to fit image to view ('fit'), display at 100% and shrink
            // if necessary ('shrink'), or always display at 100% ('100')
            defaultZoom: 'fit',
            // whether to zoom in/out toward center of view ('true') or mouse
            // ('false')
            centerZoom: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <img> element
            const imgs = document.querySelectorAll('figure > img');
            let count = 1;
            for (const img of imgs) {
                img.classList.add('lightbox_document_img');
                img.dataset.number = count;
                img.dataset.total = imgs.length;
                img.addEventListener('click', openLightbox);
                count++;
            }

            // attach mouse and key listeners to window
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('keyup', onKeyUp);
        }

        // when mouse is moved anywhere in window
        function onWindowMouseMove(event) {
            window.mouseX = event.clientX;
            window.mouseY = event.clientY;
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'lightbox_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'lightbox_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // open lightbox
        function openLightbox() {
            const lightbox = makeLightbox(this);
            if (!lightbox)
                return;

            blurBody(lightbox);
            document.body.appendChild(lightbox);
        }

        // make lightbox
        function makeLightbox(img) {
            // delete lightbox if it exists, start fresh
            closeLightbox();

            // create screen overlay containing lightbox
            const overlay = document.createElement('div');
            overlay.id = 'lightbox_overlay';

            // create image info boxes
            const numberInfo = document.createElement('div');
            const zoomInfo = document.createElement('div');
            numberInfo.id = 'lightbox_number_info';
            zoomInfo.id = 'lightbox_zoom_info';

            // create container for image
            const imageContainer = document.createElement('div');
            imageContainer.id = 'lightbox_image_container';
            const lightboxImg = makeLightboxImg(
                img,
                imageContainer,
                numberInfo,
                zoomInfo
            );
            imageContainer.appendChild(lightboxImg);

            // create bottom container for caption and navigation buttons
            const bottomContainer = document.createElement('div');
            bottomContainer.id = 'lightbox_bottom_container';
            const caption = makeCaption(img);
            const prevButton = makePrevButton(img);
            const nextButton = makeNextButton(img);
            bottomContainer.appendChild(prevButton);
            bottomContainer.appendChild(caption);
            bottomContainer.appendChild(nextButton);

            // attach top middle and bottom to overlay
            overlay.appendChild(numberInfo);
            overlay.appendChild(zoomInfo);
            overlay.appendChild(imageContainer);
            overlay.appendChild(bottomContainer);

            return overlay;
        }

        // make <img> object that is intuitively draggable and zoomable
        function makeLightboxImg(
            sourceImg,
            container,
            numberInfoBox,
            zoomInfoBox
        ) {
            // create copy of source <img>
            const img = sourceImg.cloneNode(true);
            img.classList.remove('lightbox_document_img');
            img.removeAttribute('id');
            img.removeAttribute('width');
            img.removeAttribute('height');
            img.style.position = 'unset';
            img.style.margin = '0';
            img.style.padding = '0';
            img.style.width = '';
            img.style.height = '';
            img.style.minWidth = '';
            img.style.minHeight = '';
            img.style.maxWidth = '';
            img.style.maxHeight = '';
            img.id = 'lightbox_img';

            // build sorted list of unique zoomSteps, always including a 100%
            let zoomSteps = [];
            const optionsZooms = options.zoomSteps.split(/[^0-9.]/);
            for (const optionZoom of optionsZooms) {
                const newZoom = parseFloat(optionZoom);
                if (newZoom && !zoomSteps.includes(newZoom))
                    zoomSteps.push(newZoom);
            }
            if (!zoomSteps.includes(1))
                zoomSteps.push(1);
            zoomSteps = zoomSteps.sort(function sortNumber(a, b) {
                return a - b;
            });

            // <img> object property variables
            let zoom = 1;
            let translateX = 0;
            let translateY = 0;
            let clickMouseX = undefined;
            let clickMouseY = undefined;
            let clickTranslateX = undefined;
            let clickTranslateY = undefined;

            updateNumberInfo();

            // update image numbers displayed in info box
            function updateNumberInfo() {
                numberInfoBox.innerHTML =
                    sourceImg.dataset.number + ' of ' + sourceImg.dataset.total;
            }

            // update zoom displayed in info box
            function updateZoomInfo() {
                let zoomInfo = zoom * 100;
                if (!Number.isInteger(zoomInfo))
                    zoomInfo = zoomInfo.toFixed(2);
                zoomInfoBox.innerHTML = zoomInfo + '%';
            }

            // move to closest zoom step above current zoom
            const zoomIn = function() {
                for (const zoomStep of zoomSteps) {
                    if (zoomStep > zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                updateTransform();
            };

            // move to closest zoom step above current zoom
            const zoomOut = function() {
                zoomSteps.reverse();
                for (const zoomStep of zoomSteps) {
                    if (zoomStep < zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                zoomSteps.reverse();

                updateTransform();
            };

            // update display of <img> based on scale/translate properties
            const updateTransform = function() {
                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                // get new width/height after scale
                const rect = img.getBoundingClientRect();
                // limit translate
                translateX = Math.max(translateX, -rect.width / 2);
                translateX = Math.min(translateX, rect.width / 2);
                translateY = Math.max(translateY, -rect.height / 2);
                translateY = Math.min(translateY, rect.height / 2);

                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                updateZoomInfo();
            };

            // fit <img> to container
            const fit = function() {
                // no x/y offset, 100% zoom by default
                translateX = 0;
                translateY = 0;
                zoom = 1;

                // widths of <img> and container
                const imgWidth = img.naturalWidth;
                const imgHeight = img.naturalHeight;
                const containerWidth = parseFloat(
                    window.getComputedStyle(container).width
                );
                const containerHeight = parseFloat(
                    window.getComputedStyle(container).height
                );

                // how much zooming is needed to fit <img> to container
                const xRatio = imgWidth / containerWidth;
                const yRatio = imgHeight / containerHeight;
                const maxRatio = Math.max(xRatio, yRatio);
                const newZoom = 1 / maxRatio;

                // fit <img> to container according to option
                if (options.defaultZoom === 'shrink') {
                    if (maxRatio > 1)
                        zoom = newZoom;
                } else if (options.defaultZoom === 'fit')
                    zoom = newZoom;

                updateTransform();
            };

            // when mouse wheel is rolled anywhere in container
            const onContainerWheel = function(event) {
                if (!event)
                    return;

                // let ctrl + mouse wheel to zoom behave as normal
                if (event.ctrlKey)
                    return;

                // prevent normal scroll behavior
                event.preventDefault();
                event.stopPropagation();

                // point around which to scale img
                const viewRect = container.getBoundingClientRect();
                const viewX = (viewRect.left + viewRect.right) / 2;
                const viewY = (viewRect.top + viewRect.bottom) / 2;
                const originX = options.centerZoom === 'true' ? viewX : mouseX;
                const originY = options.centerZoom === 'true' ? viewY : mouseY;

                // get point on image under origin
                const oldRect = img.getBoundingClientRect();
                const oldPercentX = (originX - oldRect.left) / oldRect.width;
                const oldPercentY = (originY - oldRect.top) / oldRect.height;

                // increment/decrement zoom
                if (event.deltaY < 0)
                    zoomIn();
                if (event.deltaY > 0)
                    zoomOut();

                // get offset between previous image point and origin
                const newRect = img.getBoundingClientRect();
                const offsetX =
                    originX - (newRect.left + newRect.width * oldPercentX);
                const offsetY =
                    originY - (newRect.top + newRect.height * oldPercentY);

                // translate image to keep image point under origin
                translateX += offsetX;
                translateY += offsetY;

                // perform translate
                updateTransform();
            };

            // when container is clicked
            function onContainerClick(event) {
                // if container itself is target of click, and not other
                // element above it
                if (event.target === this)
                    closeLightbox();
            }

            // when mouse button is pressed on image
            const onImageMouseDown = function(event) {
                // store original mouse position relative to image
                clickMouseX = window.mouseX;
                clickMouseY = window.mouseY;
                clickTranslateX = translateX;
                clickTranslateY = translateY;
                event.stopPropagation();
                event.preventDefault();
            };

            // when mouse button is released anywhere in window
            const onWindowMouseUp = function(event) {
                // reset original mouse position
                clickMouseX = undefined;
                clickMouseY = undefined;
                clickTranslateX = undefined;
                clickTranslateY = undefined;

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mouseup', onWindowMouseUp);
            };

            // when mouse is moved anywhere in window
            const onWindowMouseMove = function(event) {
                if (
                    clickMouseX === undefined ||
                    clickMouseY === undefined ||
                    clickTranslateX === undefined ||
                    clickTranslateY === undefined
                )
                    return;

                // offset image based on original and current mouse position
                translateX = clickTranslateX + window.mouseX - clickMouseX;
                translateY = clickTranslateY + window.mouseY - clickMouseY;
                updateTransform();
                event.preventDefault();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mousemove', onWindowMouseMove);
            };

            // when window is resized
            const onWindowResize = function(event) {
                fit();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('resize', onWindowResize);
            };

            // attach the necessary event listeners
            img.addEventListener('dblclick', fit);
            img.addEventListener('mousedown', onImageMouseDown);
            container.addEventListener('wheel', onContainerWheel);
            container.addEventListener('mousedown', onContainerClick);
            container.addEventListener('touchstart', onContainerClick);
            window.addEventListener('mouseup', onWindowMouseUp);
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('resize', onWindowResize);

            // run fit() after lightbox atttached to document and <img> Loaded
            // so needed container and img dimensions available
            img.addEventListener('load', fit);

            return img;
        }

        // make caption
        function makeCaption(img) {
            const caption = document.createElement('div');
            caption.id = 'lightbox_caption';
            const captionSource = img.nextElementSibling;
            if (captionSource.tagName.toLowerCase() === 'figcaption') {
                const captionCopy = makeCopy(captionSource);
                caption.innerHTML = captionCopy.innerHTML;
            }

            caption.addEventListener('touchstart', function(event) {
                event.stopPropagation();
            });

            return caption;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // make button to jump to previous image in document
        function makePrevButton(img) {
            const prevButton = document.createElement('button');
            prevButton.id = 'lightbox_prev_button';
            prevButton.title = 'Jump to the previous image in the document [←]';
            prevButton.classList.add('icon_button', 'lightbox_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;

            // attach click listeners to button
            prevButton.addEventListener('click', function() {
                getPrevImg(img).click();
            });

            return prevButton;
        }

        // make button to jump to next image in document
        function makeNextButton(img) {
            const nextButton = document.createElement('button');
            nextButton.id = 'lightbox_next_button';
            nextButton.title = 'Jump to the next image in the document [→]';
            nextButton.classList.add('icon_button', 'lightbox_button');
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;

            // attach click listeners to button
            nextButton.addEventListener('click', function() {
                getNextImg(img).click();
            });

            return nextButton;
        }

        // get previous image in document
        function getPrevImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if < 1
            if (index - 1 >= 0)
                index--;
            else
                index = imgs.length - 1;
            return imgs[index];
        }

        // get next image in document
        function getNextImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if > total
            if (index + 1 <= imgs.length - 1)
                index++;
            else
                index = 0;
            return imgs[index];
        }

        // close lightbox
        function closeLightbox() {
            focusBody();

            const lightbox = document.getElementById('lightbox_overlay');
            if (lightbox)
                lightbox.remove();
        }

        // make all elements behind lightbox non-focusable
        function blurBody(overlay) {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.tabIndex = -1;
            document.body.classList.add('body_no_scroll');
        }

        // make all elements focusable again
        function focusBody() {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.removeAttribute('tabIndex');
            document.body.classList.remove('body_no_scroll');
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- attributes plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows arbitrary HTML attributes to be attached
        // to (almost) any element. Place an HTML comment inside or next to the
        // desired element in the format <!-- $attribute="value" -->

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'attributes';

        // default plugin options
        const options = {
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // get list of comments in document
            const comments = findComments();

            for(const comment of comments)
                if (comment.parentElement)
                    addAttributes(
                        comment.parentElement,
                        comment.nodeValue.trim()
                    );
        }

        // add html attributes to specified element based on string of 
        // html attributes and values
        function addAttributes(element, text) {
            // regex's for finding attribute/value pairs in the format of
            // attribute="value" or attribute='value
            const regex2 = /\$([a-zA-Z\-]+)?=\"(.+?)\"/;
            const regex1 = /\$([a-zA-Z\-]+)?=\'(.+?)\'/;

            // loop through attribute/value pairs
            let match;
            while(match = text.match(regex2) || text.match(regex1)) {
                // get attribute and value from regex capture groups
                let attribute = match[1];
                let value = match[2];

                // remove from string
                text = text.substring(match.index + match[0].length);

                if (!attribute || !value)
                    break;

                // set attribute of parent element
                try {
                    element.setAttribute(attribute, value);
                } catch(error) {
                    console.log(error);
                }

                // special case for colspan
                if (attribute === 'colspan')
                    removeTableCells(element, value);
            }
        }

        // get list of comment elements in document
        function findComments() {
            const comments = [];

            // iterate over comment nodes in document
            function acceptNode(node) {
                return NodeFilter.FILTER_ACCEPT;
            }
            const iterator = document.createNodeIterator(
                document.body,
                NodeFilter.SHOW_COMMENT,
                acceptNode
            );
            let node;
            while(node = iterator.nextNode())
                comments.push(node);

            return comments;
        }

        // remove certain number of cells after specified cell
        function removeTableCells(cell, number) {
            number = parseInt(number);
            if (!number)
                return;

            // remove elements
            for(; number > 1; number--) {
                if (cell.nextElementSibling)
                    cell.nextElementSibling.remove();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- math plugin configuration -->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        "CommonHTML": { linebreaks: { automatic: true } },
        "HTML-CSS": { linebreaks: { automatic: true } },
        "SVG": { linebreaks: { automatic: true } },
        "fast-preview": { disabled: true }
    });
</script>

<!-- math plugin -->

<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'MathJax' allows the proper rendering of
    // math/equations written in LaTeX.

    // https://www.mathjax.org/
</script>
<!-- annotations plugin configuration -->

<script>
    window.hypothesisConfig = function() {
        return {
            branding: {
                accentColor: '#2196f3',
                appBackgroundColor: '#f8f8f8',
                ctaBackgroundColor: '#f8f8f8',
                ctaTextColor: '#000000',
                selectionFontFamily: 'Open Sans, Helvetica, sans serif',
                annotationFontFamily: 'Open Sans, Helvetica, sans serif'
            }
        };
    };
</script>

<!-- annotations plugin -->

<script src='https://hypothes.is/embed.js'>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'Hypothesis' allows public annotation of the
    // manuscript.

    // https://web.hypothes.is/
</script>
<!-- analytics plugin -->

<!-- copy and paste code from Google Analytics or similar service here -->
</body>
</html>
